<?xml version="1.0" encoding="UTF-8"?>

<!-- -*- nxml -*- -->
<transfer>

  
  <section-def-cats>

    <def-cat n="proclise">
      <cat-item tags="prn.itg.*"/>
      <cat-item tags="adv.itg"/>
      <cat-item tags="cnjsub"/>
      <cat-item tags="rel.*"/>
      <cat-item tags="adv"/>
      <cat-item tags="ij"/>
      <cat-item tags="cnjcoo"/>
      <cat-item tags="pr"/>
      <cat-item tags="cnjadv"/>
    </def-cat>

    <def-cat n="nom">
      <cat-item tags="n.*"/>
    </def-cat>
     <def-cat n="en">
      <cat-item lemma="en" tags="pr"/>
	</def-cat>

     <def-cat n="de">
      <cat-item lemma="de" tags="pr"/>
	</def-cat>

    <def-cat n="bueno_malo">
		<cat-item lemma="bono" tags="adv"/>
		<cat-item lemma="bonu" tags="adj.*"/>
		<cat-item lemma="malu" tags="n.*"/>
		<cat-item lemma="malu" tags="adj.*"/>
	</def-cat>
     	

	<def-cat n="sustantivo_temporal">
      <cat-item lemma="segundu" tags="n.*"/>	
      <cat-item lemma="minutu" tags="n.*"/>	  
      <cat-item lemma="hora" tags="n.*"/>	  
      <cat-item lemma="día" tags="n.*"/>
	  <cat-item lemma="selmana" tags="n.*"/>
      <cat-item lemma="mes" tags="n.*"/>
	  <cat-item lemma="añu" tags="n.*"/>
      <cat-item lemma="década" tags="n.*"/>	
      <cat-item lemma="lustru" tags="n.*"/>		  
      <cat-item lemma="siglu" tags="n.*"/>	
      <cat-item lemma="tiempu" tags="n.*"/>		
      <cat-item lemma="ratu" tags="n.*"/>		
      <cat-item lemma="temporada" tags="n.*"/>			  
	</def-cat>
    <!-- sustantivos temporales -->	
	
	
    <def-cat n="que">
      <cat-item tags="rel.nn.*"/>
    </def-cat>
   <!--relativo "que" -->
   
   <def-cat n="y">
      <cat-item lemma="y" tags="cnjcoo"/>	
      <cat-item lemma="ya" tags="cnjcoo"/>	  
      <cat-item lemma="anque" tags="cnjadv"/>	
      <cat-item lemma="pero" tags="cnjcoo"/>	
      <cat-item lemma="pero" tags="n.*"/>	
      <cat-item lemma="nin" tags="cnjcoo"/>	
   </def-cat>	
   <!-- 'y' y derivados -->	
	
    <def-cat n="detnt">
      <cat-item tags="detnt"/>
    </def-cat>
    <!-- determinante neutro -->

	<def-cat n="adjnt">
      <cat-item tags="adj.nt.*"/>
    </def-cat>		
    <!-- adjetivo neutro -->
	
    <def-cat n="tener">
	    <cat-item lemma="tener" tags="vblex.*"/>
    </def-cat>
    <!--verbo deber -->
    
	<def-cat n="adj_det_num_nom">
      <cat-item tags="adj.*"/>
      <cat-item tags="det.*"/>
	  <cat-item tags="num.*"/>
     <cat-item tags="n.*"/>
    </def-cat>	

    <def-cat n="nomp">
      <cat-item tags="np.ant"/>
    </def-cat>
    <def-cat n="nploc">
      <cat-item tags="np.loc"/>
    </def-cat>
    <def-cat n="det">
      <cat-item tags="det.*"/>
    </def-cat>
    <def-cat n="def">
      <cat-item tags="det.def.*"/>
    </def-cat>
    <def-cat n="pos">
      <cat-item tags="det.pos.*"/>
    </def-cat>
	<def-cat n="posmf">
      <cat-item tags="det.pos.mf.*"/>
    </def-cat>
    <def-cat n="predet">
      <cat-item tags="predet.*"/>
    </def-cat>
    <def-cat n="adjec">
      <cat-item tags="adj.*"/>
      <cat-item tags="vblex.pp.*"/>
    </def-cat>
    <def-cat n="adj">
      <cat-item tags="adj.*"/>
    </def-cat>
    <def-cat n="adv">
      <cat-item tags="adv"/>
      <cat-item tags="preadv"/>
    </def-cat>
    <def-cat n="prep">
      <cat-item tags="pr"/>
    </def-cat>
    <def-cat n="cuyo">
      <cat-item tags="rel.aa.*"/>
    </def-cat>
    <def-cat n="prn">
      <cat-item tags="prn.tn.*"/>
      <cat-item tags="prn.itg.*"/>
    </def-cat>
    <def-cat n="prnenc">
      <cat-item tags="prn.enc.*"/>
    </def-cat>
    <def-cat n="prnpro">
      <cat-item tags="prn.pro.*"/>
    </def-cat>
    <def-cat n="verb">
      <cat-item tags="vblex.*"/>
      <cat-item tags="vbser.*"/>
      <cat-item tags="vbhaver.*"/>
    </def-cat>
    <def-cat n="verbir">
      <cat-item lemma="dir" tags="vblex.*"/>
      <cat-item lemma="volver" tags="vblex.*"/>
      <cat-item lemma="acostumar" tags="vblex.*"/>
    </def-cat>
    <def-cat n="verbter">
      <cat-item lemma="tar" tags="vblex.*"/>
    </def-cat>
    <def-cat n="inf">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vbser.inf"/>
      <cat-item tags="vbhaver.inf"/>
    </def-cat>

 <def-cat n="ger">
      <cat-item tags="vblex.ger"/>
      <cat-item tags="vbser.ger"/>
      <cat-item tags="vbhaver.ger"/>
    </def-cat>
    <def-cat n="ppmsg">
      <cat-item tags="vblex.pp.m.sg"/>
      <cat-item tags="vbser.pp.m.sg"/>
      <cat-item tags="vbhaver.pp.m.sg"/>
    </def-cat>
    <def-cat n="pmp">
      <cat-item tags="vblex.pmp.*"/>
      <cat-item tags="vbser.pmp.*"/>
      <cat-item tags="vbhaver.pmp.*"/>
    </def-cat>
    <def-cat n="lquest">
      <cat-item tags="lquest"/>
    </def-cat>
    <def-cat n="num">
      <cat-item tags="num.*"/>
    </def-cat>
     <def-cat n="sent">
       <cat-item tags="sent"/>
     </def-cat>
  </section-def-cats>
  <section-def-attrs>
    <def-attr n="a_nom">
      <attr-item tags="n"/>
      <attr-item tags="n.acr"/>
    </def-attr>
    <def-attr n="a_nomp">
      <attr-item tags="np.ant"/>
    </def-attr>
    <def-attr n="a_nploc">
      <attr-item tags="np.loc"/>
    </def-attr>
    <def-attr n="a_det">
      <attr-item tags="det.def"/>
      <attr-item tags="det.ind"/>
      <attr-item tags="det.dem"/>
      <attr-item tags="det.pos"/>
    </def-attr>
    <def-attr n="a_predet">
      <attr-item tags="predet"/>
    </def-attr>
    <def-attr n="a_adjec">
      <attr-item tags="adj.ind"/>
      <attr-item tags="adj.sup"/>
      <attr-item tags="adj.itg"/>
      <attr-item tags="adj.pos"/>
      <attr-item tags="adj"/>
      <attr-item tags="vblex.pp"/>
    </def-attr>
    <def-attr n="a_adj">
      <attr-item tags="adj.ind"/>
      <attr-item tags="adj.sup"/>
      <attr-item tags="adj.itg"/>
      <attr-item tags="adj.pos"/>
      <attr-item tags="adj"/>
    </def-attr>
    <def-attr n="a_adv">
      <attr-item tags="adv"/>
      <attr-item tags="preadv"/>
    </def-attr>
    <def-attr n="a_prep">
      <attr-item tags="pr"/>
    </def-attr>
    <def-attr n="a_prn">
      <attr-item tags="prn.tn.p1"/>
      <attr-item tags="prn.tn.p2"/>
      <attr-item tags="prn.tn.p3"/>
      <attr-item tags="prn.tn"/>
      <attr-item tags="prn.tn.ref.p3"/>
      <attr-item tags="prn.tn.pos"/>
      <attr-item tags="prn.itg"/>
    </def-attr>
    <def-attr n="a_verb">
      <attr-item tags="vblex"/>
      <attr-item tags="vbser"/>
      <attr-item tags="vbhaver"/>
    </def-attr>
    <def-attr n="a_inf">
      <attr-item tags="vblex.inf"/>
      <attr-item tags="vbser.inf"/>
      <attr-item tags="vbhaver.inf"/>
    </def-attr>
    <def-attr n="a_lquest">
      <attr-item tags="lquest"/>
    </def-attr>
    <def-attr n="a_num">
      <attr-item tags="num"/>
    </def-attr>
    <def-attr n="a_prnenc">
      <attr-item tags="prn.enc"/>
      <attr-item tags="prn.enc.ref"/>
    </def-attr>
    <def-attr n="a_prnpro">
      <attr-item tags="prn.pro"/>
      <attr-item tags="prn.pro.ref"/>
    </def-attr>
    <def-attr n="gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="GD"/>
      <attr-item tags="nt"/>
    </def-attr>
    <def-attr n="nbr">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="sp"/>
      <attr-item tags="ND"/>
    </def-attr>
    <def-attr n="persona">
      <attr-item tags="p1"/>
      <attr-item tags="p2"/>
      <attr-item tags="p3"/>
    </def-attr>
    <def-attr n="temps">
      <attr-item tags="inf"/>
      <attr-item tags="ger"/>
      <attr-item tags="pp"/>
      <attr-item tags="pri"/>
      <attr-item tags="ifi"/>
      <attr-item tags="pii"/>
      <attr-item tags="fti"/>
      <attr-item tags="cni"/>
      <attr-item tags="prs"/>
      <attr-item tags="pis"/>
      <attr-item tags="fts"/>
      <attr-item tags="imp"/>
      <attr-item tags="pmp"/>
    </def-attr>

    
  </section-def-attrs>
  <section-def-vars>
    <def-var n="uno"/>
    <def-var n="genero"/>
    <def-var n="numero"/>
    <def-var n="concDet"/>
    <def-var n="concAdj"/>
    <def-var n="concPrimero"/>
    <def-var n="concSegundo"/>
    <def-var n="concTercero"/>
    <def-var n="interrogativa"/>
    <def-var n="exclamativa"/>
  </section-def-vars>
  <section-def-macros>
  
 <def-macro n="f_bcond" npar="2"><!--Per mirar si el blanc conté o no format -->
     	<choose>
     	  <when>
     	    <test>
     	      <not>
     	        <equal>
     	          <b pos="1"/>
     	          <lit v=" "/>
     	        </equal>
              </not>
     	    </test>
            <out>
              <b pos="1"/>
            </out>
          </when>     	    
     	</choose>
     </def-macro>

    
    <def-macro n="f_concord1" npar="1">
      <choose>
<!--To determine value of variables of gender and
                 number and propagate to other rules.  Variables are
                 not used again in this rule -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
<!-- If word has GD or ND, we try to assign the
              gender or number of the previous rule. If there is no
              value for the gender or number variable from previous
              rules, gender will be masculine and number singular.-->
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="genero"/>
                  <lit-tag v="f"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="f"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="m"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="numero"/>
                  <lit-tag v="pl"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="pl"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sg"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
    </def-macro>


    <def-macro n="f_concord2" npar="2">

	<choose>
        <when>
          <test>
            <!-- do the main and second parameter gender agree?-->
            <and>
              <or>
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal caseless="yes">
                  <!-- do the main and second parameter number agree?-->
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
          <!-- there is gender and number agreement-->
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
          <!-- there isn't gender and number agreement-->
        </otherwise>
      </choose>

      <choose>
        <when>
          <test>
            <!-- Propagate the main parameter gender if it has been modified during the translation -->
            <and>
              <not>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal caseless="yes">
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal caseless="yes">
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal caseless="yes">
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal caseless="yes">
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>

      <choose>
        <when>
          <test>
            <!-- Propagate the main parameter number if it has been modified during the translation -->
            <and>
              <not>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal caseless="yes">
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal caseless="yes">
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal caseless="yes">
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal caseless="yes">
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal caseless="yes">
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
            </when>
          </choose>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="nbr"/>
          </let>
        </when>
      </choose>

      <choose>
        <when>
          <test>
            <!-- Which is the rule general gender? -->
            <equal caseless="yes">
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal caseless="yes">
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal caseless="yes">
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal caseless="yes">
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>

      <choose>
        <when>
          <!-- Which is the rule general number? -->
          <test>
            <equal caseless="yes">
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal caseless="yes">
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal caseless="yes">
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal caseless="yes">
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>

      <choose>
        <!-- Determine gender and number value if they are undetermined -->
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>

      <choose>
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>

      <choose>
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>

      <choose>
        <when>
          <test>
            <equal caseless="yes">
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>

    </def-macro>



    <def-macro n="f_concord3" npar="3">
      <choose>
<!-- Look if in source language there is concordance between first and second element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Look if in source language there is concordance between second and third element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Propagate the main parameter gender if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
<!-- Propagate the main parameter number if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
<!-- Determine the rule general gender. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="3" side="sl" part="gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Determine the rule general number. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="3" side="sl" part="nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Assign values to GD and ND -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
    </def-macro>
    <def-macro n="f_concord4" npar="4">
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concTercero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concTercero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
    </def-macro>
  </section-def-macros>
  <section-rules>

 
    
    
    
    <rule>
<!-- REGLA 0: DETERMINANT -->
      <pattern>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 1: NOM -->
      <pattern>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_nom"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 2: ADJECTIU -->
      <pattern>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_adj"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 3: PRONOM -->
<!--Special case, macro f_concord1 
is not applicable because gender and number cannot be taken from previous rules -->
      <pattern>
        <pattern-item n="prn"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="GD"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_prn"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 1: NUMERAL-->
      <pattern>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_num"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
	
    <rule>
		<!-- REGLA 4b: DET_POS NOM -->
      <pattern>
        <pattern-item n="posmf"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 4: DETERMINANT NOM -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>

<!-- REGLA 5: NOM ADJECTIU-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
		<choose>
			  <when>
				<test>
				  <equal>
					<clip pos="2" side="sl" part="gen"/>
					<lit-tag v="nt"/>
				  </equal>
				</test>
				<out>
				  <lu>
					<clip pos="1" side="tl" part="lem"/>
					<clip pos="1" side="tl" part="a_nom"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="1" side="tl" part="nbr"/>
				  </lu>
				  <b pos="1"/>
				  <lu>
					<clip pos="2" side="tl" part="lem"/>
					<clip pos="2" side="tl" part="a_adj"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="2" side="tl" part="nbr"/>
				  </lu>
				</out>				
			</when>
			<otherwise>
				<out>
				  <lu>
					<clip pos="1" side="tl" part="lem"/>
					<clip pos="1" side="tl" part="a_nom"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="1" side="tl" part="nbr"/>
				  </lu>
				  <b pos="1"/>
				  <lu>
					<clip pos="2" side="tl" part="lem"/>
					<clip pos="2" side="tl" part="a_adj"/>
					<clip pos="2" side="tl" part="gen"/>
					<clip pos="2" side="tl" part="nbr"/>
				  </lu>
				</out>
			</otherwise>
		</choose>
      </action>
    </rule>
	
	
	<rule>
<!-- REGLA 5b: NOM ADJECTIU-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
        <pattern-item n="y"/>
        <pattern-item n="adjec"/>		
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="4"/>		  
        </call-macro>
		<choose>
			<when>
				<test>
				<and>
				  <equal>
					<clip pos="2" side="sl" part="gen"/>
					<lit-tag v="nt"/>
				  </equal>
				  <equal>
					<clip pos="4" side="sl" part="gen"/>
					<lit-tag v="nt"/>
				  </equal>				  
				</and>
				</test>
				<out>
				  <lu>
					<clip pos="1" side="tl" part="lem"/>
					<clip pos="1" side="tl" part="a_nom"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="1" side="tl" part="nbr"/>
				  </lu>
				  <b pos="1"/>
				  <lu>
					<clip pos="2" side="tl" part="lem"/>
					<clip pos="2" side="tl" part="a_adj"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="2" side="tl" part="nbr"/>
				  </lu>
				  <b pos="2"/>
				  <lu>
					<clip pos="3" side="tl" part="whole"/>
				  </lu>
				  <b pos="3"/>
				  <lu>
					<clip pos="4" side="tl" part="lem"/>
					<clip pos="4" side="tl" part="a_adj"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="4" side="tl" part="nbr"/>
				  </lu>				  
				</out>				
			</when>		
			  <when>
				<test>
				  <equal>
					<clip pos="2" side="sl" part="gen"/>
					<lit-tag v="nt"/>
				  </equal>
				</test>
				<out>
				  <lu>
					<clip pos="1" side="tl" part="lem"/>
					<clip pos="1" side="tl" part="a_nom"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="1" side="tl" part="nbr"/>
				  </lu>
				  <b pos="1"/>
				  <lu>
					<clip pos="2" side="tl" part="lem"/>
					<clip pos="2" side="tl" part="a_adj"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="2" side="tl" part="nbr"/>
				  </lu>
				  <b pos="2"/>
				  <lu>
					<clip pos="3" side="tl" part="whole"/>
				  </lu>
				  <b pos="3"/>
				  <lu>
					<clip pos="4" side="tl" part="lem"/>
					<clip pos="4" side="tl" part="a_adj"/>
					<clip pos="4" side="tl" part="gen"/>
					<clip pos="4" side="tl" part="nbr"/>
				  </lu>				  
				</out>				
			</when>
			  <when>
				<test>
				  <equal>
					<clip pos="4" side="sl" part="gen"/>
					<lit-tag v="nt"/>
				  </equal>
				</test>
				<out>
				  <lu>
					<clip pos="1" side="tl" part="lem"/>
					<clip pos="1" side="tl" part="a_nom"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="1" side="tl" part="nbr"/>
				  </lu>
				  <b pos="1"/>
				  <lu>
					<clip pos="2" side="tl" part="lem"/>
					<clip pos="2" side="tl" part="a_adj"/>
					<clip pos="2" side="tl" part="gen"/>
					<clip pos="2" side="tl" part="nbr"/>
				  </lu>
				  <b pos="2"/>
				  <lu>
					<clip pos="3" side="tl" part="whole"/>
				  </lu>
				  <b pos="3"/>
				  <lu>
					<clip pos="4" side="tl" part="lem"/>
					<clip pos="4" side="tl" part="a_adj"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="4" side="tl" part="nbr"/>
				  </lu>				  
				</out>					  			
			</when>			
			<otherwise>
				<out>
				  <lu>
					<clip pos="1" side="tl" part="lem"/>
					<clip pos="1" side="tl" part="a_nom"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="1" side="tl" part="nbr"/>
				  </lu>
				  <b pos="1"/>
				  <lu>
					<clip pos="2" side="tl" part="lem"/>
					<clip pos="2" side="tl" part="a_adj"/>
					<clip pos="2" side="tl" part="gen"/>
					<clip pos="2" side="tl" part="nbr"/>
				  </lu>
				  <b pos="2"/>
				  <lu>
					<clip pos="3" side="tl" part="whole"/>
				  </lu>
				  <b pos="3"/>
				  <lu>
					<clip pos="4" side="tl" part="lem"/>
					<clip pos="4" side="tl" part="a_adj"/>
					<clip pos="4" side="tl" part="gen"/>
					<clip pos="4" side="tl" part="nbr"/>
				  </lu>				  
				</out>		
			</otherwise>
		</choose>
      </action>
    </rule>	
	
    <rule>
<!-- REGLA 6: ADJECTIU NOM -->
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
		<choose>
			  <when>
				<test>
				  <equal>
					<clip pos="1" side="sl" part="gen"/>
					<lit-tag v="nt"/>
				  </equal>
				</test>
				<out>
				  <lu>
					<clip pos="1" side="tl" part="lem"/>
					<clip pos="1" side="tl" part="a_adj"/>
					<clip pos="2" side="tl" part="gen"/>
					<clip pos="1" side="tl" part="nbr"/>
				  </lu>
				  <b pos="1"/>
				  <lu>
					<clip pos="2" side="tl" part="lem"/>
					<clip pos="2" side="tl" part="a_nom"/>
					<clip pos="2" side="tl" part="gen"/>
					<clip pos="2" side="tl" part="nbr"/>
				  </lu>
				</out>				
			</when>
			<otherwise>
				<out>
				  <lu>
					<clip pos="1" side="tl" part="lem"/>
					<clip pos="1" side="tl" part="a_adj"/>
					<clip pos="1" side="tl" part="gen"/>
					<clip pos="1" side="tl" part="nbr"/>
				  </lu>
				  <b pos="1"/>
				  <lu>
					<clip pos="2" side="tl" part="lem"/>
					<clip pos="2" side="tl" part="a_nom"/>
					<clip pos="2" side="tl" part="gen"/>
					<clip pos="2" side="tl" part="nbr"/>
				  </lu>
				</out>
			</otherwise>
		</choose>
      </action>
    </rule>
	
	

    <rule>
<!-- REGLA 7: DET NOM ADJECTIU-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 8: DET ADJECTIU NOM-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 9: PREDET DET NOM-->
      <pattern>
        <pattern-item n="predet"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_predet"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_det"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 9: PREDET DET NOM ADJECTIU-->
      <pattern>
        <pattern-item n="predet"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_predet"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_det"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lem"/>
            <clip pos="4" side="tl" part="a_adjec"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 10: DETERMINANT ADJECTIU-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 11: ADJECTIU NOM ADJECTIU-->
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_adj"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 12: DET ADJECTIU NOM ADJECTIU -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lem"/>
            <clip pos="4" side="tl" part="a_adjec"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 13: NOM ADVERBI ADJECTIU-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adv"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_nom"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 14: DET NOM ADVERBI ADJECTIU -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adv"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_adv"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lem"/>
            <clip pos="4" side="tl" part="a_adjec"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 15: DET ADVERBI NOM-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adv"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 16: NUMERAL NOM -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_num"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 17: NUMERAL ADJECTIU -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_num"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 18: NUMERAL NOM ADJECTIU -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_num"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 19: NUMERAL ADJECTIU NOM -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_num"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
<!-- REGLA 21: DET NUMERAL NOM -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_num"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    
    <rule>  
 
    
<!--REGRA EGV01: V (verbos sen enclíticos)-->
      <pattern>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          
          
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="temps"/>
                <lit-tag v="pmp"/>
              </equal>
            </test>
            <out>
              <lu>
                <lit v="haber"/>
                <lit-tag v="vbhaver.pii"/>
                <clip pos="1" side="sl" part="persona"/>
                <clip pos="1" side="sl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="sl" part="a_verb"/>
                <lit-tag v="pp"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
              </lu>
            </out>
          </when>         

          <otherwise>
            
    	    <out>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
		<clip pos="1" side="tl" part="persona"/>
		<clip pos="1" side="tl" part="gen"/>
		<clip pos="1" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </out>  
          </otherwise>

        </choose>     

      </action>
    </rule>


    
<!--REGRA EGV02: V+ENC 
cómi-yos->cómeles
comí-yos->les comí
comiólu->le comió
cómese->se come
cómilo -> cómelo
comelo -> comerlo
comentándo-yos -> comentándoles
-->

  <rule>
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
         <choose>

          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="sl" part="a_prnenc"/>
                  <lit-tag v="prn.enc.ref"/>
                </equal>
                <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="inf"/>
                </equal></not>
                <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="ger"/>
                </equal></not>
                <not><equal>
                <clip pos="1" side="sl" part="temps"/>
                <lit-tag v="imp"/>
              </equal></not>
              </and>
            </test>
          <out>
            <lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.pro.ref"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="1" side="sl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="persona"/>
              <clip pos="1" side="tl" part="nbr"/>
                </lu>    
  
            </out>
          </when>


            <when>
            <test>
              <and>

		 <equal>
                 <clip pos="2" side="sl" part="lem"/>
                <lit v="lu"/>
                </equal>
	       <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="nt"/>
                </equal>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="inf"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="ger"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="imp"/>
                  </equal></not>
              </and>
            </test>
            <out> 
              <lu>
              
                   <get-case-from pos="1">
		<lit v="lo"/>
             </get-case-from>
             <lit-tag v="prn.pro"/>
             <clip pos="2" side="tl" part="persona"/>
             <lit-tag v="nt"/>
            <clip pos="2" side="tl" part="nbr"/>
	    </lu>
              <b/>
              <lu>
                <get-case-from pos="2">
                  <clip pos="1" side="tl" part="lem"/>
                </get-case-from>
                <clip pos="1" side="sl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>    
              
            </out>
          </when>

          <when>
            <test>
              <and>

		 <equal>
                 <clip pos="2" side="sl" part="lem"/>
                <lit v="lu"/>
                </equal>
	       
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="inf"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="ger"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="imp"/>
                  </equal></not>
              </and>
            </test>
            <out> 
              <lu>
              
                   <get-case-from pos="1">
		<lit v="le"/>
             </get-case-from>
             <lit-tag v="prn.pro"/>
             <clip pos="2" side="tl" part="persona"/>
             <lit-tag v="mf"/>
            <clip pos="2" side="tl" part="nbr"/>
	    </lu>
              <b/>
              <lu>
                <get-case-from pos="2">
                  <clip pos="1" side="tl" part="lem"/>
                </get-case-from>
                <clip pos="1" side="sl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>    
              
            </out>
          </when>

          <when>
            <test>
              <and>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="inf"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="ger"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="imp"/>
                  </equal></not>
              </and>
            </test>
            <out> 
              <lu>
                <get-case-from pos="1">
                  <clip pos="2" side="tl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.pro"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="2">
                  <clip pos="1" side="tl" part="lem"/>
                </get-case-from>
                <clip pos="1" side="sl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>    
              
            </out>
          </when>

          <otherwise>

    	    <out>
              <mlu>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="sl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persona"/>
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <clip pos="2" side="tl" part="lem"/>
                  <clip pos="2" side="tl" part="a_prnenc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </mlu>
            </out>  
          </otherwise>
        </choose>     
      </action>
    </rule>

 
<!--REGRA EGV02b: proclise + ENC + Verbo  
Nun lu llamé -> No le llamé
Que-yos debía -> Que les debía
Nun se mercaron el bolsu -> No se compraron el bolso
-->

  <rule>
      <pattern>
	<pattern-item n="proclise"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="verb"/>
        
      </pattern>
      <action>
         <choose>

             <when>
            <test>
              
                 <equal caseless="yes">
                  <clip pos="2" side="sl" part="lem"/>
                  <lit v="-y"/>
                </equal>
       
            </test>
          <out>
	 <lu>
              
                <clip pos="1" side="tl" part="whole"/>
              
             
            </lu><b/>
            <lu>
              <get-case-from pos="3">
                <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              
              <clip pos="3" side="sl" part="whole"/>
            </lu>    
  
            </out>
          </when>

        

          <otherwise>

    	    <out>
               <lu>
            
                <clip pos="1" side="tl" part="whole"/>
          
             
            </lu><b/>
            <lu>
	        <get-case-from pos="2">
		<lit v="le"/>
               </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="2" side="tl" part="persona"/>
              <lit-tag v="mf"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              
              <clip pos="3" side="sl" part="whole"/>
      
                </lu>    
  
            </out>  
          </otherwise>
        </choose>     
      </action>
    </rule>




 
<!--REGRA EGV02b2: proclise + proclitico + Verbo  
Nun lo llamé -> No le llamé
-->
<!--
  <rule>
      <pattern>
	<pattern-item n="proclise"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb"/>
        
      </pattern>
      <action>
        
    	    <out>
               <lu>
            
                <clip pos="1" side="tl" part="whole"/>
          
             
            </lu><b/>
            <lu>
	        <get-case-from pos="2">
		<lit v="lo"/>
               </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="2" side="tl" part="persona"/>
             <clip pos="2" side="tl" part="gen"/>
               <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              
              <clip pos="3" side="sl" part="whole"/>
      
                </lu>    
  
            </out>  
   
      </action>
    </rule>

-->
    
 

 <!--REGRA EGV03: V+ENC+ENC
cómese-yos->se les come
mercómelo->me lo compró
-->
    <rule>
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <choose>
         
        
          <when>
            <test>
              <and>
              <equal>
                 <clip pos="3" side="sl" part="lem"/>
                <lit v="lu"/>
                </equal>
		
                <equal>
                  <clip pos="2" side="sl" part="a_prnenc"/>
                  <lit-tag v="prn.enc.ref"/>
                </equal>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="inf"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="ger"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="imp"/>
                  </equal></not>
              </and>
            </test>
            <out>
              <lu>
                <get-case-from pos="1">
                  <clip pos="2" side="tl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.pro.ref"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b/>
               <lu>
              
                   <get-case-from pos="1">
		<lit v="le"/>
             </get-case-from>
             <lit-tag v="prn.pro"/>
             <clip pos="3" side="tl" part="persona"/>
             <lit-tag v="mf"/>
            <clip pos="3" side="tl" part="nbr"/>
	    </lu>
              <b/>
              <lu>
                <get-case-from pos="3">
                  <clip pos="1" side="tl" part="lem"/>
                </get-case-from>
                <clip pos="1" side="sl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>    
              
            </out>
          </when>

          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="sl" part="a_prnenc"/>
                  <lit-tag v="prn.enc.ref"/>
                </equal>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="inf"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="ger"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="imp"/>
                  </equal></not>
              </and>
            </test>
            <out>
              <lu>
                <get-case-from pos="1">
                  <clip pos="2" side="tl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.pro.ref"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="3">
                  <clip pos="1" side="tl" part="lem"/>
                </get-case-from>
                <clip pos="1" side="sl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>    
              
            </out>
          </when>
          
            <when>
            <test>
              <and>
		 <equal>
                 <clip pos="3" side="sl" part="lem"/>
                <lit v="lu"/>
                </equal>
              
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="inf"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="ger"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="imp"/>
                  </equal></not>
              </and>
            </test>
            <out>
              <lu>
                <get-case-from pos="1">
                  <clip pos="2" side="tl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.pro"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b/>
             <lu>
              
                   <get-case-from pos="1">
		<lit v="le"/>
             </get-case-from>
             <lit-tag v="prn.pro"/>
             <clip pos="3" side="tl" part="persona"/>
             <lit-tag v="mf"/>
            <clip pos="3" side="tl" part="nbr"/>
	    </lu>
              <b/>
              <lu>
                <get-case-from pos="3">
                  <clip pos="1" side="tl" part="lem"/>
                </get-case-from>
                <clip pos="1" side="sl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>    
              
            </out>
          </when>

          <when>
            <test>
              <and>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="inf"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="ger"/>
                  </equal></not>
                <not><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="imp"/>
                  </equal></not>
              </and>
            </test>
            <out>
              <lu>
                <get-case-from pos="1">
                  <clip pos="2" side="tl" part="lem"/>
                </get-case-from>
                <lit-tag v="prn.pro"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <lit-tag v="prn.pro"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="3">
                  <clip pos="1" side="tl" part="lem"/>
                </get-case-from>
                <clip pos="1" side="sl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="persona"/>
                <clip pos="1" side="tl" part="nbr"/>
              </lu>    
              
            </out>
          </when>         
          
	  <otherwise>
	    <out>
              <mlu>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="sl" part="a_verb"/>
                  <clip pos="1" side="tl" part="temps"/>
                  <clip pos="1" side="tl" part="persona"/>
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <clip pos="2" side="tl" part="lem"/>
                  <clip pos="2" side="tl" part="a_prnenc"/>                  
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <clip pos="3" side="tl" part="lem"/>
                  <clip pos="3" side="tl" part="a_prnenc"/>              
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </mlu>
            </out>  
          </otherwise>
        </choose>
      </action>
    </rule>



<!--REGRA EGV03b: proclise + ENC + ENC + Verbo  
Que me lu comió -> Que me le comió
Nun te-y debía -> No te le debía
-->

  <rule>
      <pattern>
	<pattern-item n="proclise"/>
	<pattern-item n="prnpro"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="verb"/>
        
      </pattern>
      <action>
         <choose>

             <when>
            <test>
              
                 <equal caseless="yes">
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="-y"/>
                </equal>
       
            </test>
          <out>
	 <lu>
              
                <clip pos="1" side="tl" part="whole"/>
              
             
            </lu><b/>
	    <lu>
              
                <clip pos="2" side="tl" part="whole"/>
              
             
            </lu><b/>
            <lu>
              <get-case-from pos="4">
                <clip pos="3" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="3" side="tl" part="persona"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              
              <clip pos="4" side="sl" part="whole"/>
            </lu>    
  
            </out>
          </when>

          <otherwise>

    	    <out>
               <lu>
            
                <clip pos="1" side="tl" part="whole"/>
          
             
            </lu><b/>
	    <lu>
            
                <clip pos="2" side="tl" part="whole"/>
          
             
            </lu><b/>
            <lu>
	        <get-case-from pos="3">
		<lit v="le"/>
               </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="3" side="tl" part="persona"/>
              <lit-tag v="mf"/>
              <clip pos="3" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              
              <clip pos="4" side="sl" part="whole"/>
      
                </lu>    
  
            </out>  
          </otherwise>
        </choose>     
      </action>
    </rule>




    <!--REGRA EGV04: ir/vir + inf = ir/venir + a + inf 
	    voi comer -> voy a comer
	-->
    <rule>
      <pattern>
        <pattern-item n="verbir"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
         <out>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
            <b pos="1"/>
            <lu>
	      <get-case-from pos="2">
              <lit v="a"/>
	      </get-case-from>
	      <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
          </out>
        </action>
      </rule>

      
      <!--REGRA EGV05: ir/vir + inf + enc 
		voi comelo -> lo voy a comer	  
	  -->
      <!--está por facer con ir/vir en pmp-->
      <rule>
        <pattern>
          <pattern-item n="verbir"/>
		  <pattern-item n="inf"/>
          <pattern-item n="prnenc"/>
        </pattern>
        <action>
          <choose>
            <when>
              <test>
                <and>
                  <equal>
                    <clip pos="3" side="sl" part="a_prnenc"/>
                    <lit-tag v="prn.enc.ref"/>
                  </equal>
                  <not><equal>
                      <clip pos="1" side="sl" part="temps"/>
                      <lit-tag v="inf"/>
                    </equal></not>
                  <not><equal>
                      <clip pos="1" side="sl" part="temps"/>
                      <lit-tag v="ger"/>
                    </equal></not>
                  <not><equal>
                      <clip pos="1" side="sl" part="temps"/>
                      <lit-tag v="imp"/>
                    </equal></not>
                </and>
              </test>
              <out>
                <lu>
                  <get-case-from pos="1">
                    <clip pos="3" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.pro.ref"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <b/>
                <lu>
                  <get-case-from pos="2">
                  <clip pos="1" side="tl" part="whole"/>
                </get-case-from>
                </lu>
                <b/>
                <lu>
                  <get-case-from pos="2">
                    <lit v="a"/>
                  </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
            </lu> 
              </out>
            </when>
            <when>
              <test>
                <and>
                  <not><equal>
                      <clip pos="1" side="sl" part="temps"/>
                      <lit-tag v="inf"/>
                    </equal></not>
                  <not><equal>
                      <clip pos="1" side="sl" part="temps"/>
                      <lit-tag v="ger"/>
                    </equal></not>
                  <not><equal>
                      <clip pos="1" side="sl" part="temps"/>
                      <lit-tag v="imp"/>
                    </equal></not>
                </and>
              </test>
              <out>
                <lu>
                  <get-case-from pos="1">
                    <clip pos="3" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.pro"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <b/>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="1" side="tl" part="whole"/>
                  </get-case-from>
                </lu>
                <b/>
                <lu>
                  <get-case-from pos="2">
                    <lit v="a"/>
                  </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
              </out>
            </when>
          <otherwise>
              <out>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
                <b/>
                <lu>
                  <get-case-from pos="2">
                    <lit v="a"/>
                  </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <mlu>
                  <lu>
                    <clip pos="2" side="tl" part="lemh"/>
                    <clip pos="2" side="sl" part="a_verb"/>
                    <clip pos="2" side="tl" part="temps"/>
                    <clip pos="2" side="tl" part="persona"/>
                    <clip pos="2" side="tl" part="nbr"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_prnenc"/>
                    <clip pos="3" side="tl" part="persona"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="nbr"/>
                    <clip pos="3" side="tl" part="lemq"/>
                  </lu>
              </mlu>
              </out>  
            </otherwise>
          </choose>     
        </action>
    </rule>
    
    
    <!--REGRA EGV06: ir/vir + enc + inf -->
    <!--está por facer con ir/vir en pmp-->
    <rule>
      <pattern>
        <pattern-item n="verbir"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <choose>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="sl" part="a_prnenc"/>
                <lit-tag v="prn.enc.ref"/>
              </equal>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="inf"/>
                </equal></not>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="ger"/>
                </equal></not>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="imp"/>
                </equal></not>
            </and>
          </test>
          <out>
            <lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.pro.ref"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="whole"/>
              </get-case-from>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <lit v="a"/>
              </get-case-from>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu>
              <clip pos="3" side="tl" part="whole"/>
            </lu> 
          </out>
        </when>
        <when>
          <test>
            <and>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="inf"/>
                </equal></not>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="ger"/>
                </equal></not>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="imp"/>
                </equal></not>
            </and>
          </test>
          <out>
            <lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="whole"/>
              </get-case-from>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <lit v="a"/>
              </get-case-from>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu>
              <clip pos="3" side="tl" part="whole"/>
            </lu>
          </out>
        </when>
        <otherwise>
          <out>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <lit v="a"/>
              </get-case-from>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <mlu>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="sl" part="a_verb"/>
                <clip pos="3" side="tl" part="temps"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="nbr"/>
              </lu>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_prnenc"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </mlu>
          </out>  
        </otherwise>
      </choose>     
    </action>
    </rule>
    
    <!--REGRA EGV07: ir/vir + inf + enc +enc 
		voi contátelo -> te lo voy a contar
	-->
    <!--está por facer con ir/vir en pmp-->
    <rule>
      <pattern>
        <pattern-item n="verbir"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <choose>
        <when>
          <test>
            <and>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="inf"/>
                </equal></not>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="ger"/>
                </equal></not>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="imp"/>
                </equal></not>
            </and>
          </test>
          <out>
            <lu>
              <get-case-from pos="1">
                <clip pos="3" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="3" side="tl" part="persona"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <clip pos="4" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="4" side="tl" part="persona"/>
              <clip pos="4" side="tl" part="gen"/>
              <clip pos="4" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="whole"/>
              </get-case-from>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <lit v="a"/>
              </get-case-from>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu>
              <clip pos="2" side="tl" part="whole"/>
            </lu>
          </out>
        </when>
        <otherwise>
          <out>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <lit v="a"/>
              </get-case-from>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <mlu>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="sl" part="a_verb"/>
                <clip pos="2" side="tl" part="temps"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="nbr"/>
              </lu>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_prnenc"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <lu>
                <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_prnenc"/>
                <clip pos="4" side="tl" part="persona"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="nbr"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
            </mlu>
          </out>  
        </otherwise>
      </choose>     
    </action>
    </rule>
    
    <!--REGRA EGV08: ir/vir + enc + enc + inf  -->
    <!--está por facer con ir/vir en pmp-->
    <rule>
      <pattern>
        <pattern-item n="verbir"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <choose>
        <when>
          <test>
            <and>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="inf"/>
                </equal></not>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="ger"/>
                </equal></not>
              <not><equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="imp"/>
                </equal></not>
            </and>
          </test>
          <out>
            <lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <clip pos="3" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="3" side="tl" part="persona"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="whole"/>
              </get-case-from>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <lit v="a"/>
              </get-case-from>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <lu>
              <clip pos="4" side="tl" part="whole"/>
            </lu>
          </out>
        </when>
        <otherwise>
          <out>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <lit v="a"/>
              </get-case-from>
              <lit-tag v="pr"/>
            </lu>
            <b/>
            <mlu>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="sl" part="a_verb"/>
                <clip pos="4" side="tl" part="temps"/>
                <clip pos="4" side="tl" part="persona"/>
                <clip pos="4" side="tl" part="nbr"/>
              </lu>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_prnenc"/>
                <clip pos="2" side="tl" part="persona"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_prnenc"/>
                <clip pos="3" side="tl" part="persona"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </mlu>
          </out>  
        </otherwise>
      </choose>     
    </action>
    </rule>
    

<!-- 
regla PERIF09 en + ger -> tras + inf 
en comiendo -> tras comer
-->  
 
<rule>
      <pattern>
        <pattern-item n="en"/>
        <pattern-item n="ger"/>
      </pattern>
      <action>

        <out>
	
            <lu>
            <get-case-from pos="1">
		<lit v="tras"/>
            </get-case-from>
		<lit-tag v="pr"/>
    	    </lu>
               
            <b/>
             <lu>
              <get-case-from pos="2">
               <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="2" side="tl" part="a_verb"/>
              <lit-tag v="inf"/>
              
            </lu>
        </out>
     </action>
</rule>


<!-- 
regla PERIF09b en + ger +enc -> tras + inf 
En comiendolo -> Tras comerlo
En comiéndolu -> Tras comerle
En debiéndo-yos -> Tras deberles
-->  
 
<rule>
      <pattern>
        <pattern-item n="en"/>
        <pattern-item n="ger"/>
	<pattern-item n="prnenc"/>
      </pattern>
      <action>

       <choose>

            <when>
            <test>
		<and>

		 <equal>
                 <clip pos="3" side="sl" part="lem"/>
                <lit v="lu"/>
                </equal>
	       <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="nt"/>
                </equal>
              </and>
            </test>
            <out> 

              
            <lu>
            <get-case-from pos="1">
		<lit v="tras"/>
            </get-case-from>
		<lit-tag v="pr"/>
    	    </lu>
               
            <b/>
            <mlu><lu>
              <get-case-from pos="2">
               <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="2" side="tl" part="a_verb"/>
              <lit-tag v="inf"/>
             </lu>
             <lu>
		  <get-case-from pos="2">
		<lit v="lo"/>
             </get-case-from>
             <lit-tag v="prn.enc"/>
             <clip pos="3" side="tl" part="persona"/>
             <lit-tag v="nt"/>
            <clip pos="3" side="tl" part="nbr"/>
	    </lu>
           </mlu>
         
            </out>
          </when>

          <when>
            <test>

		 <equal>
                 <clip pos="3" side="sl" part="lem"/>
                <lit v="lu"/>
                </equal>
	     
            </test>
            <out> 

              
            <lu>
            <get-case-from pos="1">
		<lit v="tras"/>
            </get-case-from>
		<lit-tag v="pr"/>
    	    </lu>
               
            <b/>
            <mlu><lu>
              <get-case-from pos="2">
               <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="2" side="tl" part="a_verb"/>
              <lit-tag v="inf"/>
             </lu>
             <lu>
		<get-case-from pos="1">
		<lit v="le"/>
             </get-case-from>
             <lit-tag v="prn.enc"/>
             <clip pos="3" side="tl" part="persona"/>
             <lit-tag v="mf"/>
            <clip pos="3" side="tl" part="nbr"/>
	   
	     </lu>
           </mlu>
         
            </out>
          </when>

        <otherwise>
        <out>
	
            <lu>
            <get-case-from pos="1">
		<lit v="tras"/>
            </get-case-from>
		<lit-tag v="pr"/>
    	    </lu>
               
            <b/>
            <mlu><lu>
              <get-case-from pos="2">
               <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="2" side="tl" part="a_verb"/>
              <lit-tag v="inf"/>
             </lu>
             <lu>
		<clip pos="3" side="tl" part="whole"/>
	     </lu>
           </mlu>
        </out>
       </otherwise>
     </choose>
     </action>
</rule>

	
<!-- 
regla PERIF09b en + ger +enc + enc -> tras + inf 
En comiéndoselo -> Tras comérselo
En comiéndotelu -> Tras comértele
En debiéndose-yos -> Tras debérseles

-->  
 
<rule>
      <pattern>
        <pattern-item n="en"/>
        <pattern-item n="ger"/>
	<pattern-item n="prnenc"/>
	<pattern-item n="prnenc"/>
      </pattern>
      <action>

       <choose>

            <when>
            <test>
		<and>

		 <equal>
                 <clip pos="4" side="sl" part="lem"/>
                <lit v="lu"/>
                </equal>
	       <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="nt"/>
                </equal>
              </and>
            </test>
            <out> 

              
            <lu>
            <get-case-from pos="1">
		<lit v="tras"/>
            </get-case-from>
		<lit-tag v="pr"/>
    	    </lu>
               
            <b/>
            <mlu><lu>
              <get-case-from pos="2">
               <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="2" side="tl" part="a_verb"/>
              <lit-tag v="inf"/>
             </lu>
              <lu> 
               <clip pos="3" side="tl" part="whole"/>
              </lu>
             <lu>
		  <get-case-from pos="2">
		<lit v="lo"/>
             </get-case-from>
             <lit-tag v="prn.enc"/>
             <clip pos="4" side="tl" part="persona"/>
             <lit-tag v="nt"/>
            <clip pos="4" side="tl" part="nbr"/>
	    </lu>
           </mlu>
         
            </out>
          </when>

        <when>
            <test>

		 <equal>
                 <clip pos="4" side="sl" part="lem"/>
                <lit v="lu"/>
                </equal>
	     
            </test>
            <out> 

              
            <lu>
            <get-case-from pos="1">
		<lit v="tras"/>
            </get-case-from>
		<lit-tag v="pr"/>
    	    </lu>
               
            <b/>
            <mlu><lu>
              <get-case-from pos="2">
               <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="2" side="tl" part="a_verb"/>
              <lit-tag v="inf"/>
             </lu>
             <lu>
		<clip pos="3" side="tl" part="whole"/>
	     </lu>
             <lu>
		<get-case-from pos="2">
		<lit v="le"/>
             </get-case-from>
             <lit-tag v="prn.enc"/>
             <clip pos="4" side="tl" part="persona"/>
             <lit-tag v="mf"/>
            <clip pos="4" side="tl" part="nbr"/>
	   
	     </lu>
           </mlu>
         
            </out>
          </when>

        <otherwise>
        <out>
	
            <lu>
            <get-case-from pos="1">
		<lit v="tras"/>
            </get-case-from>
		<lit-tag v="pr"/>
    	    </lu>
               
            <b/>
            <mlu><lu>
              <get-case-from pos="2">
               <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="2" side="tl" part="a_verb"/>
              <lit-tag v="inf"/>
             </lu>
             <lu>
		<clip pos="3" side="tl" part="whole"/>
	     </lu>
               <lu>
		<clip pos="4" side="tl" part="whole"/>
	     </lu>
           </mlu>
        </out>
       </otherwise>
     </choose>
     </action>
</rule>

  

<!-- 
regla PERIF10 (bon, bonu,mal,malu) + de + inf -> (fácil,difícil) +de+ inf 
Bono d'estudiar -> Fácil de estudiar

-->  
 
 <rule>
      <pattern>
        <pattern-item n="bueno_malo"/>
        <pattern-item n="de"/>		
        <pattern-item n="inf"/>
      </pattern>
      <action>
	<choose>
	   <when>
            <test>
                  <or>
				<equal caseless="yes">
				     <clip pos="1" side="sl" part="lem"/>
					 <lit v="bonu"/>
				</equal>
				<equal caseless="yes">
				     <clip pos="1" side="sl" part="lem"/>
					 <lit v="bono"/>
				</equal>
                   </or>
			</test>	  
			<out>
			  <lu>
				 <get-case-from pos="1">
				<lit v="fácil"/>
				</get-case-from>
				<lit-tag v="adj.mf.sg"/>
				
			  </lu>
			  <b pos="1"/>
			  <lu>
				<clip pos="2" side="tl" part="whole"/>
			  </lu>
			<b pos="1"/>
			  <lu>
				<clip pos="3" side="tl" part="whole"/>
			  </lu>			  
			</out>
		</when>
	   <otherwise> 
			<out>
			  <lu>
				<get-case-from pos="1">
				<lit v="difícil"/>
				</get-case-from>
		
				<lit-tag v="adj.mf.sg"/>
				
			  </lu>
			  <b pos="1"/>
			  <lu>
				<clip pos="2" side="tl" part="whole"/>
			  </lu>
			<b pos="1"/>
			  <lu>
				<clip pos="3" side="tl" part="whole"/>
			  </lu>			  
			</out>
		</otherwise>	
	  </choose>
      </action>
    </rule>



<!-- 
regla EGV51 dir + sustantivo_temporal -> facer + sustantivo_temporal
-->  

<rule>
      <pattern>
        <pattern-item n="verbir"/>
        <pattern-item n="sustantivo_temporal"/>
      </pattern>
      <action>
	  <choose>
	   <when>
        <test>
		  <and>
			  <equal caseless="yes">
				 <clip pos="1" side="sl" part="persona"/>
				  <lit-tag v="p3"/>
			  </equal>
			  <equal caseless="yes">
				 <clip pos="1" side="sl" part="nbr"/>
				  <lit-tag v="sg"/>
			  </equal>		
		  </and>
        </test>
        <out>
            <lu>
		       <get-case-from pos="1">
			    <lit v="hacer"/>
			</get-case-from>
               <clip pos="1" side="tl" part="a_verb"/>
               <clip pos="1" side="tl" part="temps"/>
               <clip pos="1" side="tl" part="persona"/>
               <clip pos="1" side="tl" part="nbr"/>
			</lu>
             <b/>
            <lu>
		      <clip pos="2" side="tl" part="whole"/> 
			</lu> 		    
        </out>
       </when>
      </choose>
     </action>
    </rule>	

<!-- VA dos años -> HACE dos años -->
<!-- 
regla EGV51 hacer + det/num/adj + sustantivo_temporal -> DIR + det/num/adj + sustantivo_temporal
-->  

<rule>
      <pattern>
        <pattern-item n="verbir"/>
	<pattern-item n="adj_det_num_nom"/>
        <pattern-item n="sustantivo_temporal"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>	
	  <choose>
	   <when>
        <test>
		  <and>
			  <equal caseless="yes">
				 <clip pos="1" side="sl" part="persona"/>
				  <lit-tag v="p3"/>
			  </equal>
			  <equal caseless="yes">
				 <clip pos="1" side="sl" part="nbr"/>
				  <lit-tag v="sg"/>
			  </equal>		
		  </and>
        </test>
        <out>
            <lu>
		       <get-case-from pos="1">
			    <lit v="hacer"/>
			</get-case-from>
               <clip pos="1" side="tl" part="a_verb"/>
               <clip pos="1" side="tl" part="temps"/>
               <clip pos="1" side="tl" part="persona"/>
               <clip pos="1" side="tl" part="nbr"/>
			</lu>
            <b/>
            <lu>
		      <clip pos="2" side="tl" part="whole"/> 
			</lu>
             <b/>
            <lu>
		      <clip pos="3" side="tl" part="whole"/> 
			</lu> 		    
        </out>
       </when>
      </choose>
     </action>
    </rule>		
	
    
    
  
    <!-- 
     regla EGV51 tener + de + inf -> deber + inf
    tienen de cantar -> deben cantar

    -->  
    
    <rule>
	    <pattern>
		    <pattern-item n="tener"/>
		    <pattern-item n="de"/>
		    <pattern-item n="inf"/>
	    </pattern>
	    <action>
		   
		 <out>
		 	<lu>
			    <get-case-from pos="1">
			    <lit v="deber"/>
		            </get-case-from>
			    <clip pos="1" side="tl" part="a_verb"/>
			    <clip pos="1" side="tl" part="temps"/>
			    <clip pos="1" side="tl" part="persona"/>
			    <clip pos="1" side="tl" part="nbr"/>
		         </lu>
			 <b/>
			
			 <lu>
			     <clip pos="3" side="tl" part="whole"/> 
			  </lu>
        </out>
	    </action>
    </rule>		

    
    <!-- 
	 regla EGV52 tener + de + inf + enc -> deber + inf + enc
    teníen de comeles -> debían comerlas
    
    -->  
    
    <rule>
	    <pattern>
		    <pattern-item n="tener"/>
		    <pattern-item n="de"/>
		    <pattern-item n="inf"/>
		    <pattern-item n="prnenc"/>
	    </pattern>
	    <action>
		    
		    <out>
			    <lu>
				    <get-case-from pos="1">
					    <lit v="deber"/>
				    </get-case-from>
				    <clip pos="1" side="tl" part="a_verb"/>
				    <clip pos="1" side="tl" part="temps"/>
				    <clip pos="1" side="tl" part="persona"/>
				    <clip pos="1" side="tl" part="nbr"/>
			    </lu>
			    <b/>
			    
			    <mlu>
			     <lu>
				    <clip pos="3" side="tl" part="whole"/> 
			    </lu>
			    <lu>
				    <clip pos="4" side="tl" part="whole"/> 
			    </lu>
		    	   </mlu>
		    </out>
	    </action>
    </rule>	
    
    
    
    <!-- 
	 regla EGV53 tener + de + inf + enc + enc-> deber + inf + enc + enc
    tendríen de coméseles -> deberían comérselas
    
    -->  
    
    <rule>
	    <pattern>
		    <pattern-item n="tener"/>
		    <pattern-item n="de"/>
		    <pattern-item n="inf"/>
		    <pattern-item n="prnenc"/>
		    <pattern-item n="prnenc"/>
	    </pattern>
	    <action>
		    
		    <out>
			    <lu>
				    <get-case-from pos="1">
					    <lit v="deber"/>
				    </get-case-from>
				    <clip pos="1" side="tl" part="a_verb"/>
				    <clip pos="1" side="tl" part="temps"/>
				    <clip pos="1" side="tl" part="persona"/>
				    <clip pos="1" side="tl" part="nbr"/>
			    </lu>
			    <b/>
			    
			    <mlu>
				    <lu>
					    <clip pos="3" side="tl" part="whole"/> 
				    </lu>
				    <lu>
					    <clip pos="4" side="tl" part="whole"/> 
				    </lu>
				    <lu>
					    <clip pos="5" side="tl" part="whole"/> 
				    </lu>
			    </mlu>
		    </out>
	    </action>
    </rule>		
	
	
	
<!-- 
regla EGV42 "LO" + ADJ nt + QUE relativo + verbo + determinante + sustantivo -> ADJ género concuerda con nombre
Lo blanco que taba la nieve -> Lo blanca que estaba la nieve
Lo blanco que taba la nieve -> Lo blanca que estaba la nieve
-->  

    
    <rule>
      <pattern>
        <pattern-item n="detnt"/>
        <pattern-item n="adjnt"/>
        <pattern-item n="que"/>
        <pattern-item n="verb"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>

        <out>
            <lu>
			<clip pos="1" side="tl" part="whole"/> 
			</lu>
			<b pos="1"/>
			<lu>
				<clip pos="2" side="tl" part="lem"/>
				<clip pos="2" side="tl" part="a_adjec"/>
				<clip pos="6" side="tl" part="gen"/>
				<clip pos="2" side="tl" part="nbr"/>
			</lu>
          	<b pos="2"/>
            <lu>
				<clip pos="3" side="tl" part="whole"/> 
			</lu>
          	<b pos="3"/>
			<lu>
				<clip pos="4" side="tl" part="lem"/>
				<clip pos="4" side="tl" part="a_verb"/>
				<clip pos="4" side="tl" part="temps"/>
				<clip pos="4" side="tl" part="persona"/>
				<clip pos="4" side="tl" part="nbr"/>
			</lu>
			<b pos="4"/>
			<lu>
				<clip pos="5" side="tl" part="lem"/>
				<clip pos="5" side="tl" part="a_det"/>
				<clip pos="5" side="tl" part="gen"/>
				<clip pos="5" side="tl" part="nbr"/>
			</lu>
			<b pos="5"/>
			<lu>
					<clip pos="6" side="tl" part="lem"/>
					<clip pos="6" side="tl" part="a_nom"/>
					<clip pos="6" side="tl" part="gen"/>
					<clip pos="6" side="tl" part="nbr"/>
			</lu>
        </out>
  
      </action>

    </rule>	
	
	
    <!--
	REGRA EGN1: contracción(prep+def)+posesivo
		al mio andamiu -> a mi andamio
	-->
	
    <rule>
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="def"/>
        <pattern-item n="pos"/>
      </pattern>
      <action>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/>  
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>  
              </lu>
            </out>
      </action>
    </rule>


  
  
  <rule> <!-- REGRA: reset variables-->
    <pattern>
      <pattern-item n="sent"/>
    </pattern>
    <action>
      <let>
        <var n="numero"/>
        <lit-tag v="sg"/>
      </let>
      <let>
        <var n="genero"/>
        <lit-tag v="m"/>
      </let>
      <out>
        <lu>
          <clip pos="1" side="tl" part="whole"/>
        </lu>
      </out>
    </action>
    </rule>
    
  </section-rules>
</transfer>
