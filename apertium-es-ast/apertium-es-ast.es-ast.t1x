<?xml version="1.0" encoding="UTF-8"?>

<transfer>

<!--COMIENZA LA SECCIÓN DE DEFINICIÓN DE CATEGORIAS-->

  <section-def-cats>
 
    <def-cat n="detnt">
      <cat-item tags="detnt"/>
    </def-cat>
    <!-- determinante neutro -->

    <def-cat n="proclise">
      <cat-item tags="prn.itg.*"/>
      <cat-item tags="adv.itg"/>
      <cat-item tags="cnjsub"/>
      <cat-item tags="rel.*"/>
      <cat-item tags="adv"/>
      <cat-item tags="ij"/>
      <cat-item tags="prn.*"/>
      <cat-item tags="cnjcoo"/>
      <cat-item tags="pr"/>
      <cat-item tags="cnjadv"/>
    </def-cat>
    <!-- posibles casos de proclisis -->

    <def-cat n="longa_proclise">
      <cat-item tags="prn.itg.*"/>
      <cat-item tags="adv.itg"/>
      <cat-item tags="cnjsub"/>
      <cat-item tags="rel.*"/>
    </def-cat>
    <!-- -->

    <def-cat n="intermed">
      <cat-item tags="detnt"/>
      <cat-item tags="n.*"/>
      <cat-item tags="np.ant"/>
      <cat-item tags="np.loc"/>
      <cat-item tags="adv"/>
      <cat-item tags="preadv"/>
      <cat-item tags="pr"/>
      <cat-item tags="num.*"/>
      <cat-item tags="prn.tn.*"/>
    </def-cat>
    <!-- -->

    <def-cat n="nom">
      <cat-item tags="n.*"/>
    </def-cat>
    <!-- sustantivos -->

    <def-cat n="nomp">
      <cat-item tags="np.ant"/>
    </def-cat>
    <!-- nombre propio antropónimo -->

    <def-cat n="nploc">
      <cat-item tags="np.loc"/>
    </def-cat>
    <!-- nombre propio locativo  -->

    <def-cat n="det">
      <cat-item tags="det.*"/>
    </def-cat>
    <!-- todos los determinantes -->

    <def-cat n="predet">
      <cat-item tags="predet.*"/>
    </def-cat>
    <!-- predeterminante -->

    <def-cat n="adjec">
      <cat-item tags="adj.*"/>
      <cat-item tags="vblex.pp.*"/>
    </def-cat>
    <!-- adjetivos y participios de verbos flexivos (también considerados adjetivos)-->

    <def-cat n="adj">
      <cat-item tags="adj.*"/>
    </def-cat>
    <!-- adjetivos propiamente dicho -->

    <def-cat n="adv">
      <cat-item tags="adv"/>
      <cat-item tags="preadv"/>
    </def-cat>
    <!-- adverbios y preadverbios -->

    <def-cat n="prep">
      <cat-item tags="pr"/>
    </def-cat>
    <!-- preposiciones -->

    <def-cat n="cuyo">
      <cat-item tags="rel.aa.*"/>
    </def-cat>
    <!--relativos adjetivos -->

    <def-cat n="prn">
      <cat-item tags="prn.tn.*"/>
      <cat-item tags="prn.itg.*"/>
    </def-cat>
    <!--pronombre tónicos y pronombres interrogativos -->

    <def-cat n="prnenc">
      <cat-item tags="prn.enc.*"/>
    </def-cat>
    <!--pronombres enclíticos -->

    <def-cat n="prnpro">
      <cat-item tags="prn.pro.*"/>
    </def-cat>
    <!--pronombres proclíticos -->

    <def-cat n="prnproref">
      <cat-item tags="prn.pro.ref.*"/>
    </def-cat>
    <!--pronombres proclíticos reflexivos -->

    <def-cat n="verb">
      <cat-item tags="vblex.*"/>
      <cat-item tags="vbser.*"/>
      <cat-item tags="vbhaver.*"/>
      <cat-item tags="vbter.*"/>
      <cat-item tags="vbmod.*"/>
    </def-cat>
    <!--verbo léxico,ser , haber,  -->

    <def-cat n="verbir">
      <cat-item lemma="ir" tags="vblex.*"/>
      <cat-item lemma="venir" tags="vblex.*"/>
      <cat-item lemma="volver" tags="vblex.*"/>
      <cat-item lemma="acostumbrar" tags="vblex.*"/>
    </def-cat>
    <!--verbos léxicos con lemas ir, venir, volver o acostumbrar -->

    <def-cat n="haber">
      <cat-item tags="vbhaver.*"/>
    </def-cat>
    <!--verbo haber -->

    <def-cat n="inf">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vbser.inf"/>
      <cat-item tags="vbhaver.inf"/>
      <cat-item tags="vbmod.inf"/>
    </def-cat>
    <!--verbo léxico, ser, haber o modal en su forma de infinitivo -->

    <def-cat n="lquest">
      <cat-item tags="lquest"/>
    </def-cat>
    <!--¿ -->

    <def-cat n="num">
      <cat-item tags="num.*"/>
    </def-cat>
    <!--numerales -->

    <def-cat n="sent">
      <cat-item tags="sent"/>
    </def-cat>
    <!-- ? ; : ! -->
 
  </section-def-cats>


<!--COMIENZA LA SECCIÓN DE DEFINICIÓN DE ATRIBUTOS-->

  <section-def-attrs>
    
    <def-attr n="a_nom">
      <attr-item tags="n"/>
      <attr-item tags="n.acr"/>
    </def-attr>
    <!--nombres o nombres acrónimos -->


    <def-attr n="a_nomp">
      <attr-item tags="np.ant"/>
    </def-attr>
    <!--nombres propios antropónimos -->


    <def-attr n="a_nploc">
      <attr-item tags="np.loc"/>
    </def-attr>
    <!--nombres propios locativos -->


    <def-attr n="a_det">
      <attr-item tags="det.def"/>
      <attr-item tags="det.ind"/>
      <attr-item tags="det.dem"/>
      <attr-item tags="det.pos"/>
    </def-attr>
    <!-- determinantes definidos, indefinidos, demostrativos y posesivos-->


    <def-attr n="a_predet">
      <attr-item tags="predet"/>
    </def-attr>
    <!--predeterminantes -->


    <def-attr n="a_adjec">
      <attr-item tags="adj.ind"/>
      <attr-item tags="adj.sup"/>
      <attr-item tags="adj.itg"/>
      <attr-item tags="adj.pos"/>
      <attr-item tags="adj"/>
      <attr-item tags="vblex.pp"/>
    </def-attr>
    <!--adjetivos indefinidos, superlativos, interrogativos, posesivos,adejetivos y verbos léxicos en su forma de participio -->


    <def-attr n="a_adj">
      <attr-item tags="adj.ind"/>
      <attr-item tags="adj.sup"/>
      <attr-item tags="adj.itg"/>
      <attr-item tags="adj.pos"/>
      <attr-item tags="adj"/>
    </def-attr>
    <!--adjetivos indefinidos, superlativos, interrogativos , posesivos y adjetivos -->


    <def-attr n="a_adv">
      <attr-item tags="adv"/>
      <attr-item tags="preadv"/>
    </def-attr>
    <!--adverbios y preadverbios -->


    <def-attr n="a_prep">
      <attr-item tags="pr"/>
    </def-attr>
    <!--preposiciones -->


    <def-attr n="a_cuyo">
      <attr-item tags="rel.aa"/>
    </def-attr>
    <!--relativos adjetivales -->


    <def-attr n="a_prn">
      <attr-item tags="prn.tn.p1"/>
      <attr-item tags="prn.tn.p2"/>
      <attr-item tags="prn.tn.p3"/>
      <attr-item tags="prn.tn"/>
      <attr-item tags="prn.tn.ref.p3"/>
      <attr-item tags="prn.tn.pos"/>
      <attr-item tags="prn.itg"/>
    </def-attr>
    <!--pronombres tónicos de 1ª, 2ª y 3ª persona, tónico reflexivo de 3ª persona, tónicos posesivos y pronombres interrogativos -->


    <def-attr n="a_verb">
      <attr-item tags="vblex"/>
      <attr-item tags="vbser"/>
      <attr-item tags="vbhaver"/>
      <attr-item tags="vbter"/>
      <attr-item tags="vbmod"/>
    </def-attr>
    <!--verbos léxico, verbo ser, haber,y verbo modal -->


    <def-attr n="a_inf">
      <attr-item tags="vblex.inf"/>
      <attr-item tags="vbser.inf"/>
      <attr-item tags="vbhaver.inf"/>
      <attr-item tags="vbmod.inf"/>
    </def-attr>
    <!--verbo léxico, ser, haber o modal en sus formas infinitivas -->


    <def-attr n="a_perif">
      <attr-item tags="vblex.ifi"/>
      <attr-item tags="vbser.ifi"/>
      <attr-item tags="vbhaver.ifi"/>
      <attr-item tags="vbmod.ifi"/>
    </def-attr>
    <!--verbo léxico, ser, haber o modal en su forma de pretérito perfecto o indefinido -->


    <def-attr n="a_lquest">
      <attr-item tags="lquest"/>
    </def-attr>
    <!-- ¿ -->


    <def-attr n="a_num">
      <attr-item tags="num"/>
    </def-attr>
    <!--numerales -->


    <def-attr n="a_prnenc">
      <attr-item tags="prn.enc"/>
      <attr-item tags="prn.enc.ref"/>
    </def-attr>
    <!--pronombres enclíticos y pronombres enclíticos reflexivos -->


    <def-attr n="gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="GD"/>
      <attr-item tags="nt"/>
    </def-attr>
    <!--atributo para el genero que puede ser masculino, femenino, masculino-femenino,genero por definir  y neutro-->


    <def-attr n="nbr">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="sp"/>
      <attr-item tags="ND"/>
    </def-attr>
    <!--atributo para el número, singular, plural, singular-plural y no definido-->


    <def-attr n="persona">
      <attr-item tags="p1"/>
      <attr-item tags="p2"/>
      <attr-item tags="p3"/>
    </def-attr>
    <!--atributo persona, primera, segunda y tercera-->


    <def-attr n="temps">
      <attr-item tags="inf"/>
      <attr-item tags="ger"/>
      <attr-item tags="pp"/>
      <attr-item tags="pri"/>
      <attr-item tags="ifi"/>
      <attr-item tags="pii"/>
      <attr-item tags="fti"/>
      <attr-item tags="cni"/>
      <attr-item tags="prs"/>
      <attr-item tags="pis"/>
      <attr-item tags="fts"/>
      <attr-item tags="imp"/>
    </def-attr>
    <!--tiempos verbales, infinitov, gerundio, participio,preterito perfecto, futuro etc..-->


  </section-def-attrs>


<!--DEFINICIÓN DE VARIABLES A UTILIZAR EN LAS REGLAS-->


  <section-def-vars>
    <def-var n="uno"/>
    <def-var n="genero"/>
    <def-var n="numero"/>
    <def-var n="concDet"/>
    <def-var n="concAdj"/>
    <def-var n="concPrimero"/>
    <def-var n="concSegundo"/>
    <def-var n="concTercero"/>
    <def-var n="interrogativa"/>
    <def-var n="exclamativa"/>
  </section-def-vars>


<!--LISTAS A UTILIZAR EN LAS REGLAS-->
  
  <section-def-lists>

    <!--lista para búsqueda de proclisis-->    
    <def-list n="pces">
      <list-item v="que"/>
      <list-item v="dónde"/>
      <list-item v="donde"/>
      <list-item v="adónde"/>
      <list-item v="adonde"/>
      <list-item v="cómo"/>
      <list-item v="como"/>
      <list-item v="cuándo"/>
      <list-item v="cuando"/>
      <list-item v="cuánto"/>
      <list-item v="cuanto"/>
      <list-item v="qué"/>
      <list-item v="quién"/>
      <list-item v="quien"/>
      <list-item v="porque"/>
      <list-item v="aunque"/>
      <list-item v="pero"/>
      <list-item v="ojalá"/>
      <list-item v="no"/>
      <list-item v="quizás"/>
      <list-item v="quizá"/>
      <list-item v="nunca"/>
      <list-item v="jamás"/>
      <list-item v="nada"/>
      <list-item v="nadie"/>
      <list-item v="ni"/>
      <list-item v="ni que"/>
      <list-item v="aunque"/>
      <list-item v="si"/>
      <list-item v="excepto si"/>
      <list-item v="incluso"/>
      <list-item v="tampoco"/>
      <list-item v="algo"/>
      <list-item v="alguien"/>
      <list-item v="alguno"/>
      <list-item v="ambos"/>
      <list-item v="bastante"/>
      <list-item v="cualquiera"/>
      <list-item v="todo"/>
      <list-item v="otro"/>
      <list-item v="mucho"/>
      <list-item v="poco"/>
      <list-item v="tanto"/>
      <list-item v="más"/>
      <list-item v="menos"/>
      <list-item v="demasiado"/>
      <list-item v="acaso"/>
      <list-item v="hasta"/>
      <list-item v="casi"/>
      <list-item v="igual"/>
      <list-item v="incluso"/>
      <list-item v="seguramente"/>
      <list-item v="todavía"/>
      <list-item v="ya"/>
      <list-item v="también"/>
      <list-item v="sólo"/>
      <list-item v="siempre"/>
      <list-item v="apenas"/>
      <list-item v="pronto"/>
      <list-item v="sí"/>
      <list-item v="aún"/>
      <list-item v="bien"/>
      <list-item v="en seguida"/>
      <list-item v="temprano"/>
      <list-item v="mal"/>
      <list-item v="mejor"/>
      <list-item v="peor"/>
      <list-item v="tarde"/>
      <list-item v="o"/>
      <list-item v="para que"/>
      <list-item v="siempre y cuando"/>
      <list-item v="a fin de que"/>
      <list-item v="a menos que"/>
      <list-item v="a nada que"/>
      <list-item v="a no ser que"/>
      <list-item v="a poco que"/>
      <list-item v="al tiempo que"/>
      <list-item v="basta con que"/>
      <list-item v="excepto que"/>
      <list-item v="ahora que"/>
      <list-item v="si bien"/>
      <list-item v="antes de que"/>
      <list-item v="antes que"/>
      <list-item v="a lo que"/>
      <list-item v="así"/>
      <list-item v="así que"/>
      <list-item v="hasta que"/>
      <list-item v="tan pronto"/>
      <list-item v="bien que"/>
      <list-item v="cada vez que"/>
      <list-item v="cuando quiera que"/>
      <list-item v="con el fin de que"/>
      <list-item v="comoquiera que"/>
      <list-item v="con que"/>
      <list-item v="con tal de que"/>
      <list-item v="dada cuenta que"/>
      <list-item v="dado el caso de que"/>
      <list-item v="dado que"/>
      <list-item v="conforme"/>
      <list-item v="tal y como"/>
      <list-item v="tal cual"/>
      <list-item v="de manera que"/>
      <list-item v="de forma que"/>
      <list-item v="de modo que"/>
      <list-item v="de no ser que"/>
      <list-item v="de suerte que"/>
      <list-item v="de aquí que"/>
      <list-item v="desde que"/>
      <list-item v="después de que"/>
      <list-item v="al igual que"/>
      <list-item v="y eso que"/>
      <list-item v="por eso es por lo que"/>
      <list-item v="en favor de que"/>
      <list-item v="por lo que"/>
      <list-item v="en tanto"/>
      <list-item v="en tanto que"/>
      <list-item v="fuera de que"/>
      <list-item v="luego que"/>
      <list-item v="en caso de que"/>
      <list-item v="no obstante que"/>
      <list-item v="donde quiera que"/>
      <list-item v="para lo cual"/>
      <list-item v="para que"/>
      <list-item v="mientras"/>
      <list-item v="mientras que"/>
      <list-item v="entre tanto"/>
      <list-item v="pues"/>
      <list-item v="pues que"/>
      <list-item v="por causa de que"/>
      <list-item v="por cosa de que"/>
      <list-item v="por culpa de que"/>
      <list-item v="de ahí que"/>
      <list-item v="por más que"/>
      <list-item v="por mucho que"/>
      <list-item v="por poco que"/>
      <list-item v="puesto que"/>
      <list-item v="salvo que"/>
      <list-item v="siempre que"/>
      <list-item v="sin que"/>
      <list-item v="sino que"/>
      <list-item v="con sólo que"/>
      <list-item v="toda vez que"/>
      <list-item v="todo lo bien que"/>
      <list-item v="visto que"/>
      <list-item v="ya que"/>
      <list-item v="en cuanto que"/>
      <list-item v="en el supuesto de que"/>
      <list-item v="en tanto en cuanto"/>
      <list-item v="a condición de que"/>
      <list-item v="en donde"/>
      <list-item v="a lo mejor"/>
    </def-list>

    <!--lista para búsqueda de incontables-->    
    <def-list n="incontables">
	<list-item v="leña"/>
	<list-item v="agua"/>
	<list-item v="leche"/>
	<list-item v="pan"/>
	<list-item v="madera"/>
	<list-item v="aire"/>
	<list-item v="luz"/>
	<list-item v="sal"/>
	<list-item v="caldo"/>
	<list-item v="harina"/>
	<list-item v="nieve"/>
	<list-item v="vino"/>
	<list-item v="azúcar"/>
	<list-item v="manteca"/>
	<list-item v="té"/>
	<list-item v="queso"/>
    </def-list>

  </section-def-lists>



 <!-- SECCIÓN DE MACROS -->

 
  <section-def-macros>
    

    <def-macro n="f_bcond" npar="1">
    <!--Per mirar si el blanc conté o no format -->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <b pos="1"/>
                <lit v=" "/>
              </equal>
            </not>
          </test>
          <out>
            <b pos="1"/>
          </out>
        </when> 
      </choose>
    </def-macro>




      <!--To determine value of variables of gender and number and propagate to other rules. Variables are not used again in this rule -->

    
    <def-macro n="f_concord1" npar="1">
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <!-- If word has GD or ND, we try to assign the
                 gender or number of the previous rule. If there is no
                 value for the gender or number variable from previous
                 rules, gender will be masculine and number singular.-->
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="genero"/>
                  <lit-tag v="f"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="f"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="m"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="numero"/>
                  <lit-tag v="pl"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="pl"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sg"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
    </def-macro>






    <def-macro n="f_concord2" npar="2">
      <choose>
        <when>
          <test>
            <!-- do the main and second parameter gender agree?-->
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <!-- do the main and second parameter number agree?-->
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
          <!-- there is gender and number agreement-->
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
          <!-- there isn't gender and number agreement-->
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <!-- Propagate the main parameter gender if it has been modified during the translation -->
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <!-- Propagate the main parameter number if it has been modified during the translation -->
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
            </when>
          </choose>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="nbr"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <!-- Which is the rule general gender? -->
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <!-- Which is the rule general number? -->
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <!-- Determine gender and number value if they are undetermined -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
    </def-macro>





    <def-macro n="f_concord3" npar="3">
      <choose>
        <!-- Look if in source language there is concordance between first and second element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <!-- Look if in source language there is concordance between second and third element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <!-- Propagate the main parameter gender if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <!-- Propagate the main parameter number if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <!-- Determine the rule general gender. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>

        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="3" side="sl" part="gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <!-- Determine the rule general number. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="3" side="sl" part="nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <!-- Assign values to GD and ND -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
    </def-macro>



    <def-macro n="f_concord4" npar="4">
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concTercero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concTercero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
    </def-macro>
  </section-def-macros>





<!-- SECCIÓN DE REGLAS -->


  <section-rules>


    <rule>
      <!-- REGLA 0: DETERMINANT -->
      <pattern>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
        </out>

      </action>
    </rule>


    <rule>
      <!-- REGLA 1: NOM -->
      <pattern>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_nom"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>



    <rule>
      <!-- REGLA 2: ADJECTIU -->
      <pattern>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_adj"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>


    <rule>
      <!-- REGLA 3: PRONOM -->
      <!--Special case, macro f_concord1 is not applicable because gender and number cannot be taken from previous rules -->
      <pattern>
        <pattern-item n="prn"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="GD"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </let>
          </when>
        </choose>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_prn"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>


    <rule>
      <!-- REGLA 1: NUMERAL-->
      <pattern>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_num"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>


    <rule>
      <!-- REGLA 4: DETERMINANT NOM -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>


    <rule>
      <!-- REGLA 5: NOM ADJECTIU-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_nom"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>


    <rule>
      <!-- REGLA 6: ADJECTIU NOM -->
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_adj"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>


    <rule>
      <!-- REGLA 7: DET NOM ADJECTIU-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>



    <rule>
      <!-- REGLA 8: DET ADJECTIU NOM-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>


    <rule>
      <!-- REGLA 9: PREDET DET NOM-->
      <pattern>
        <pattern-item n="predet"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_predet"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_det"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>


    <rule>
      <!-- REGLA 9: PREDET DET NOM ADJECTIU-->
      <pattern>
        <pattern-item n="predet"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_predet"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_det"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lem"/>
            <clip pos="4" side="tl" part="a_adjec"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>


    <rule>
      <!-- REGLA 10: DETERMINANT ADJECTIU-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>


    <rule>
      <!-- REGLA 11: ADJECTIU NOM ADJECTIU-->
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_adj"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
      <!-- REGLA 12: DET ADJECTIU NOM ADJECTIU -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lem"/>
            <clip pos="4" side="tl" part="a_adjec"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
      <!-- REGLA 13: NOM ADVERBI ADJECTIU-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adv"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_nom"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
      <!-- REGLA 14: DET NOM ADVERBI ADJECTIU -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adv"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="4"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_adv"/>
          </lu>
          <b pos="3"/>
          <lu>
            <clip pos="4" side="tl" part="lem"/>
            <clip pos="4" side="tl" part="a_adjec"/>
            <clip pos="4" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
      <!-- REGLA 15: DET ADVERBI NOM-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adv"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adv"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
      <!-- REGLA 16: NUMERAL NOM -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_num"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
      <!-- REGLA 17: NUMERAL ADJECTIU -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_num"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
      <!-- REGLA 18: NUMERAL NOM ADJECTIU -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_num"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nom"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_adjec"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
      <!-- REGLA 19: NUMERAL ADJECTIU NOM -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_num"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_adjec"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>

      <!-- REGLA 21: DET NUMERAL NOM -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_det"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_num"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="nbr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_nom"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="nbr"/>
          </lu>
        </out>
      </action>
    </rule>
    <rule>
      

      <!--REGRA EGV01: verbos sen enclíticos)-->
      <!--Ejemplo: soy -->

      <pattern>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <out>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="persona"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
        </out>
      </action>
    </rule>
    

    <!-- REGRA EGV02 para os verbos con enclise v+enc+enc--> 
    <!--Ejemplo: dímelo -->

    <rule>
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="lem"/>
                  <lit v="le"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="le"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <clip pos="1" side="tl" part="whole"/> 
                </lu> 
                <lu>
                  <get-case-from pos="2">
                    <lit v="se"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref.p3.mf.sp"/>
                </lu>
                <lu>
                  <clip pos="3" side="tl" part="whole"/> 
                </lu></mlu>
            </out> 
          </when>
          <otherwise> 
            <out>
              <mlu><lu>
                  <clip pos="1" side="tl" part="whole"/> 
                </lu> 
                <lu>
                  <clip pos="2" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <clip pos="3" side="tl" part="whole"/> 
                </lu></mlu>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    
    
    
    <!-- REGRA EGV03 v+enc--> 
    <!--Ejemplo: dime -->

    <rule>
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <out>
          <mlu><lu>
              <clip pos="1" side="tl" part="whole"/> 
            </lu> 
            
            <lu>
              <clip pos="2" side="tl" part="whole"/> 
            </lu></mlu>
        </out> 
        
      </action>
    </rule>
    
    


    <!-- REGRA EGV04 proclisis+algo+algo+pronombre+haber+verbo--> 
    <!--Ejemplo: Dónde más veces te ha ganado -->
    
    <rule>
      <pattern>
        <pattern-item n="longa_proclise"/>
        <pattern-item n="intermed"/>
        <pattern-item n="intermed"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>

      <action>
        <choose>          
          <when>
            <test>

              <and>                
                <in caseless="yes"><!--in-->
                  <clip pos="1" side="sl" part="lem"/>
                  <list n="pces"/>
                </in>
                
                <equal>
                  <clip pos="6" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>

                <equal>
                  <clip pos="6" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>

                <equal>
                  <clip pos="6" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>

              </and>

            </test>

            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="6" side="tl" part="lem"/> 
                <clip pos="6" side="sl" part="a_verb"/>
                <lit-tag v="ifi"/>
                <clip pos="5" side="sl" part="persona"/>
                <clip pos="5" side="sl" part="nbr"/>
              </lu>
            </out> 
          </when>
          
          
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="6" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="6" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="6" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
	      <lu>
		      <get-case-from pos="5">
			      <clip pos="4" side="tl" part="lem"/>
		      </get-case-from>
		      <lit-tag v="prn.enc"/>
		      <clip pos="4" side="tl" part="persona"/>
		      <clip pos="4" side="tl" part="gen"/>
		      <clip pos="4" side="tl" part="nbr"/>
                </lu>
		<b/>
		<lu>
                  <get-case-from pos="4">
                    <clip pos="6" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="6" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="5" side="sl" part="persona"/>
                  <clip pos="5" side="sl" part="nbr"/>
                </lu>

              
            </out> 
          </when>
          
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="6" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>
    


    <!-- REGRA EGV05 proclisis+algo+pronombre+haber+verbo--> 
    <!--Ejemplo:Dónde más te he ganado -->
  
    <rule>
      <pattern>
        <pattern-item n="longa_proclise"/>
        <pattern-item n="intermed"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          
          
          
          <when>
            <test>
              <and>
                
                <in caseless="yes"><!--in-->
                <clip pos="1" side="sl" part="lem"/>
                <list n="pces"/>
              </in>
                
                <equal>
                  <clip pos="5" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="5" side="tl" part="lem"/> 
                <clip pos="5" side="sl" part="a_verb"/>
                <lit-tag v="ifi"/>
                <clip pos="4" side="sl" part="persona"/>
                <clip pos="4" side="sl" part="nbr"/>
              </lu>
            </out> 
          </when>
          
          
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="5" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <get-case-from pos="3">
                    <clip pos="5" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="5" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="4" side="sl" part="persona"/>
                  <clip pos="4" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="4">
                    <clip pos="3" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>
    


    <!-- REGRA EGV06 proclisis+algo+algo+pronombre_proclitico_reflexivo+pronombre_procl+haber+verbo--> 
    <!--Dónde más veces se lo ha encontrado-->
    
    <rule>
      <pattern>
        <pattern-item n="longa_proclise"/>
        <pattern-item n="intermed"/>
        <pattern-item n="intermed"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          
          
          
          <when>
            <test>
              <and>
                
                <in caseless="yes"><!--in-->
                  <clip pos="1" side="sl" part="lem"/>
                  <list n="pces"/>
                </in>
                
                <equal>
                  <clip pos="7" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="7" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="7" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="7" side="tl" part="lem"/> 
                <clip pos="7" side="sl" part="a_verb"/>
                <lit-tag v="ifi"/>
                <clip pos="6" side="sl" part="persona"/>
                <clip pos="6" side="sl" part="nbr"/>
              </lu>
            </out> 
          </when>
          
          
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="7" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="7" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="7" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <get-case-from pos="4">
                    <clip pos="7" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="7" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="6" side="sl" part="persona"/>
                  <clip pos="6" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="4">
                    <lit v="lle"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p3.mf.sg"/>
                </lu>
                <lu>
                  <get-case-from pos="6">
                    <clip pos="5" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="5" side="tl" part="persona"/>
                  <clip pos="5" side="tl" part="gen"/>
                  <clip pos="5" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="6" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="7" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>



    <!-- REGLA EGV07 proclisis+algo+pronombre_proclitico_reflexivo+pronombre_procl+haber+verbo--> 
    
    
    <rule>
      <pattern>
        <pattern-item n="longa_proclise"/>
        <pattern-item n="intermed"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          
          
          
          <when>
            <test>
              <and>
                
                <in caseless="yes"><!--in-->
                  <clip pos="1" side="sl" part="lem"/>
                  <list n="pces"/>
                </in>
                
                <equal>
                  <clip pos="6" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="6" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="6" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="6" side="tl" part="lem"/> 
                <clip pos="6" side="sl" part="a_verb"/>
                <lit-tag v="ifi"/>
                <clip pos="5" side="sl" part="persona"/>
                <clip pos="5" side="sl" part="nbr"/>
              </lu>
            </out> 
          </when>
          
          
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="6" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="6" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="6" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <get-case-from pos="3">
                    <clip pos="6" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="6" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="5" side="sl" part="persona"/>
                  <clip pos="5" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="3">
                    <lit v="lle"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p3.mf.sg"/>
                </lu>
                <lu>
                  <get-case-from pos="5">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="4" side="tl" part="persona"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="6" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>
    
    
    <!-- EGV15.REGRA: HABER + PP: propro+propro+vC
         me lo ha besado - bícoumo
         La persona que más veces te lo ha encontrado
         -->
    <rule>
      <pattern>
        <pattern-item n="longa_proclise"/>
        <pattern-item n="intermed"/>
        <pattern-item n="intermed"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          
          
          
          <when>
            <test>
              <and>
                
                <in caseless="yes"><!--in-->
                  <clip pos="1" side="sl" part="lem"/>
                  <list n="pces"/>
                </in>
                
                <equal>
                  <clip pos="7" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="7" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="7" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="7" side="tl" part="lem"/> 
                <clip pos="7" side="sl" part="a_verb"/>
                <lit-tag v="ifi"/>
                <clip pos="5" side="sl" part="persona"/>
                <clip pos="5" side="sl" part="nbr"/>
              </lu>
            </out> 
          </when>
          
          
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="7" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="7" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="7" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <get-case-from pos="4">
                    <clip pos="7" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="7" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="6" side="sl" part="persona"/>
                  <clip pos="6" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="6">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="4" side="tl" part="persona"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="6">
                    <clip pos="5" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="5" side="tl" part="persona"/>
                  <clip pos="5" side="tl" part="gen"/>
                  <clip pos="5" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="6" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="7" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>
    


 <!--
    EGV16 proclisis + algo + pronombre_procl + pronombre_procl + haber + participio.
La persona que más te lo ha encontrado 
-->
    
    <rule>
      <pattern>
        <pattern-item n="longa_proclise"/>
        <pattern-item n="intermed"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          
          
          
          <when>
            <test>
              <and>
                
                <in caseless="yes"><!--in-->
                  <clip pos="1" side="sl" part="lem"/>
                  <list n="pces"/>
                </in>
                
                <equal>
                  <clip pos="6" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="6" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="6" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="6" side="tl" part="lem"/> 
                <clip pos="6" side="sl" part="a_verb"/>
                <lit-tag v="ifi"/>
                <clip pos="4" side="sl" part="persona"/>
                <clip pos="4" side="sl" part="nbr"/>
              </lu>
            </out> 
          </when>
          
          
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="6" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="6" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="6" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <get-case-from pos="3">
                    <clip pos="6" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="6" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="5" side="sl" part="persona"/>
                  <clip pos="5" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="5">
                    <clip pos="3" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="5">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="4" side="tl" part="persona"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="6" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>
    


<!--    
EGV17 proclisis + algo + algo + pronombre_procl + pronombre_procl + verbo.
La persona que más veces te lo encuentra 
-->    

    <rule>
      <pattern>
        <pattern-item n="longa_proclise"/>
        <pattern-item n="intermed"/>
        <pattern-item n="intermed"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb"/>
      </pattern>
      
      <action>
        <choose>
          <when>
            <test>
              <in caseless="yes"><!--in-->
                <clip pos="1" side="sl" part="lem"/>
                <list n="pces"/>
              </in>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="6" side="tl" part="whole"/>
                
              </lu>
            </out> 
            
          </when>
          
          <when>
            <test><and>
                <equal caseless="yes">
                  <clip pos="4" side="sl" part="lem"/>
                  <lit v="se"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="5" side="sl" part="lem"/>
                  <lit v="le"/>
                </equal></and>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="6" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <get-case-from pos="4">
                    <lit v="se"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref.p3.mf.sp"/>
                </lu>
                <lu>
                  <clip pos="5" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="5" side="tl" part="persona"/>
                  <clip pos="5" side="tl" part="gen"/>
                  <clip pos="5" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
            
          </when>
          
          
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="4" side="sl" part="lem"/>
                <lit v="se"/>
              </equal>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="6" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <get-case-from pos="4">
                    <lit v="lle"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p3.mf.sg"/>
                </lu>
                <lu>
                  <clip pos="5" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="5" side="tl" part="persona"/>
                  <clip pos="5" side="tl" part="gen"/>
                  <clip pos="5" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
            
          </when>
          
          <otherwise>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="6" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <clip pos="4" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="4" side="tl" part="persona"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <clip pos="5" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="5" side="tl" part="persona"/>
                  <clip pos="5" side="tl" part="gen"/>
                  <clip pos="5" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
            
          </otherwise>
          
        </choose>
      </action>
    </rule> 




<!--
EGV18 proclisis + algo + pronombre_procl + pronombre_procl + verbo.
La persona que más te lo encuentra
-->
    
    
    <rule>
      <pattern>
        <pattern-item n="longa_proclise"/>
        <pattern-item n="intermed"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb"/>
      </pattern>
      
      <action>
        <choose>
          <when>
            <test>
              <in caseless="yes"><!--in-->
                <clip pos="1" side="sl" part="lem"/>
                <list n="pces"/>
              </in>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/>
                
              </lu>
            </out> 
            
          </when>
          
          <when>
            <test><and>
                <equal caseless="yes">
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="se"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="4" side="sl" part="lem"/>
                  <lit v="le"/>
                </equal></and>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="5" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <get-case-from pos="3">
                    <lit v="se"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref.p3.mf.sp"/>
                </lu>
                <lu>
                  <clip pos="4" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="4" side="tl" part="persona"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
            
          </when>
          
          
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="3" side="sl" part="lem"/>
                <lit v="se"/>
              </equal>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="5" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <get-case-from pos="3">
                    <lit v="lle"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p3.mf.sg"/>
                </lu>
                <lu>
                  <clip pos="4" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="4" side="tl" part="persona"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
            
          </when>
          
          <otherwise>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="5" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <clip pos="3" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <clip pos="4" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="4" side="tl" part="persona"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
            
          </otherwise>
          
        </choose>
      </action>
    </rule> 
    


<!--
EGV19 proclisis + algo + algo + pronombre_procl + verbo.
La persona que más veces lo encuentra
-->
    
    
    <rule>
      
      <pattern>
        <pattern-item n="longa_proclise"/>
        <pattern-item n="intermed"/>
        <pattern-item n="intermed"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb"/>
      </pattern>
      
      <action>
        <choose>
          <when>
            <test>
              <in caseless="yes"><!--in-->
                <clip pos="1" side="sl" part="lem"/>
                <list n="pces"/>
              </in>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/>
                
              </lu>
            </out> 
            
          </when>
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <mlu><lu>
                  <clip pos="5" side="tl" part="lem"/>
                  <clip pos="5" side="tl" part="a_verb"/>
                  <clip pos="5" side="tl" part="temps"/>
                  <clip pos="5" side="tl" part="persona"/>
                  <clip pos="5" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <clip pos="4" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="4" side="tl" part="persona"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
          </otherwise>
          
        </choose>
      </action>
    </rule>
    


<!--
EGV20 proclisis + algo + pronombre_procl + verbo.
La persona que más lo encuentra
-->


    <rule>
      
      <pattern>
        <pattern-item n="longa_proclise"/>
        <pattern-item n="intermed"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb"/>
      </pattern>
      
      <action>
        <choose>
          <when>
            <test>
              <in caseless="yes"><!--in-->
                <clip pos="1" side="sl" part="lem"/>
                <list n="pces"/>
              </in>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
                
              </lu>
            </out> 
            
          </when>
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <mlu><lu>
                  <clip pos="4" side="tl" part="lem"/>
                  <clip pos="4" side="tl" part="a_verb"/>
                  <clip pos="4" side="tl" part="temps"/>
                  <clip pos="4" side="tl" part="persona"/>
                  <clip pos="4" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <clip pos="3" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
          </otherwise>
          
        </choose>
      </action>
    </rule>


    
<!--
EGV21 proclisis + pronombre_procl + pronombre_procl + verbo.
La persona que te lo encuentra
-->

    
    
    <rule>
      <pattern>
        <pattern-item n="proclise"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb"/>
      </pattern>
      
      <action>
        <choose>
          <when>
            <test>
              <in caseless="yes"><!--in-->
                <clip pos="1" side="sl" part="lem"/>
                <list n="pces"/>
              </in>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/>
                
              </lu>
            </out> 
            
          </when>
          
          <when>
            <test><and>
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="lem"/>
                  <lit v="se"/>
                </equal>
                <equal caseless="yes">
                  <clip pos="3" side="sl" part="lem"/>
                  <lit v="le"/>
                </equal></and>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="4" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <lit v="se"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref.p3.mf.sp"/>
                </lu>
                <lu>
                  <clip pos="3" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
            
          </when>
          
          
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="2" side="sl" part="lem"/>
                <lit v="se"/>
              </equal>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="4" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <lit v="lle"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p3.mf.sg"/>
                </lu>
                <lu>
                  <clip pos="3" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
            
          </when>
          
          <otherwise>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="4" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <clip pos="2" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <clip pos="3" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
            
          </otherwise>
          
        </choose>
      </action>
    </rule>
    
    
    
    
<!--
EGV22 pronombre_procl_reflex + pronombre_procl + verbo.
se lo encuentra
-->
    
    <rule>
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb"/>
      </pattern>
      
      <action>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes">
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="se"/>
                </equal>  
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="lem"/>
                  <lit v="le"/>
                </equal>
              </and>           
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="3" side="tl" part="lem"/>
                  </get-case-from>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <lit v="se"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref.p3.mf.sp"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
          </when>
          <otherwise>
            
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="3" side="tl" part="lem"/>
                  </get-case-from>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <lit v="lle"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p3.mf.sg"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
          </otherwise>
          
        </choose>
      </action>
    </rule>
    


<!--
EGV23 pronombre_procl + pronombre_procl + verbo.
te lo encuentra
-->
    
    <rule>
      <pattern>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <out>
          <mlu><lu>
              <get-case-from pos="1">
                <clip pos="3" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="3" side="tl" part="a_verb"/>
              <clip pos="3" side="tl" part="temps"/>
              <clip pos="3" side="tl" part="persona"/>
              <clip pos="3" side="tl" part="nbr"/>
            </lu>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.enc"/>
              <clip pos="1" side="tl" part="persona"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
            <lu>
              <get-case-from pos="2">
                <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.enc"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu></mlu>
        </out> 
      </action>
    </rule>
    
    
    
<!--
EGV24 pronombre_procl_refl + verbo.
se encuentra
-->
    
    <rule>
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <out>
          <mlu><lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.enc.ref"/>
              <clip pos="1" side="tl" part="persona"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu></mlu>
        </out> 
      </action>
    </rule>
    


<!--
EGV25 pronombre_procl + verbo.
lo encuentra
-->

    
    <rule>
      <pattern>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <out>
          <mlu><lu>
              <get-case-from pos="1">
                <clip pos="2" side="tl" part="lem"/>
              </get-case-from>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="persona"/>
              <clip pos="2" side="tl" part="nbr"/>
            </lu>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="lem"/>
              </get-case-from>
              <lit-tag v="prn.enc"/>
              <clip pos="1" side="tl" part="persona"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu></mlu>
        </out> 
      </action>
    </rule>



    
<!--
EGV26 proclisis + pronom_procl_refl + verbo.
que se jugó ('que' está en la lista)
y se jugó ('y' no está en la lista)
-->
   
 
    <rule>
      <pattern>
        <pattern-item n="proclise"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="verb"/>
      </pattern>
      
      <action>
        <choose>
          <when>
            <test>
              <in caseless="yes"><!--in-->
                <clip pos="1" side="sl" part="lem"/>
                <list n="pces"/>
              </in>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
                
              </lu>
            </out> 
            
          </when>
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="3" side="tl" part="lem"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <clip pos="2" side="tl" part="lem"/>
                  <lit-tag v="prn.enc.ref"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
          </otherwise>
          
        </choose>
      </action>
    </rule>


    
<!--
EGV27 proclisis + pronom_procl + verbo.
que lo jugó ('que' está en la lista)
y lo jugó ('y' no está en la lista)
-->
    
    <rule>
      
      <pattern>
        <pattern-item n="proclise"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verb"/>
      </pattern>
      
      <action>
        <choose>
          <when>
            <test>
              <in caseless="yes"><!--in-->
                <clip pos="1" side="sl" part="lem"/>
                <list n="pces"/>
              </in>
            </test>
            
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
                
              </lu>
            </out> 
            
          </when>
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="3" side="tl" part="lem"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <clip pos="3" side="tl" part="temps"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <clip pos="2" side="tl" part="lem"/>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
            </out> 
          </otherwise>
          
        </choose>
      </action>
    </rule>



<!--
EGV28 haber + participio.
he cantado (presente_indicativo + participio -> pretérito_perfecto/indefinido - cantei)
había cantado (pretérito_imperfecto_indicativo + participio -> pluscuamperfecto - cantara)
habré/habría cantado (futuro_indicativo/condicional + participio -> condicional cantaría)
(presente_subjuntivo/pert_imperf_subj/infinitivo/gerundio + participio -> presente_subjuntivo/pert_imperf_subj/infinitivo/gerundio)
	haya cantado -> cante
	hubiera cantado -> cantase
	haber cantado-> cantar
-->

    
    <rule>
      <pattern>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="sl" part="a_verb"/>
                <lit-tag v="ifi"/>
                <clip pos="1" side="sl" part="persona"/>
                <clip pos="1" side="sl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="1"/>
            </call-macro>
          </when>
          
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="temps"/>
                  <lit-tag v="pii"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="sl" part="a_verb"/>
                <lit-tag v="pmp"/>
                <clip pos="1" side="sl" part="persona"/>
                <clip pos="1" side="sl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="1"/>
            </call-macro>
          </when>
          
          <when>
            <test>
              <and>
                <or><equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="fti"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="cni"/>
                  </equal></or>
                <equal>
                  <clip pos="2" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="sl" part="a_verb"/>
                <lit-tag v="cni"/>
                <clip pos="1" side="sl" part="persona"/>
                <clip pos="1" side="sl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="1"/>
            </call-macro>
          </when>
          
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="pis"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="prs"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="inf"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="temps"/>
                    <lit-tag v="xer"/>
                  </equal></or>
                <equal>
                  <clip pos="2" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="sl" part="a_verb"/>
                <clip pos="1" side="sl" part="temps"/>
                <clip pos="1" side="sl" part="persona"/>
                <clip pos="1" side="sl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </out>
            <call-macro n="f_bcond">
              <with-param pos="1"/>
            </call-macro>
          </when>
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>


<!--
EGV29 pron_procl_refl + pron_procl + haber + participio.
se le ha caído -> caéuselle (pretérito_perfecto)
se lo ha dicho -> díxollo (dicir+lle+o)
se le había caído -> caéraselle (caer-pluscuamperfecto + se + lle)
se lo había dicho -> dixérallo  (dicir-pluscuamperfecto + lle + o)
se le habría/habrá caído -> caeríaselle   (caer-condicional + se + lle)
se lo habría/habrá dicho -> diríallo   (dicir-condicional + lle + o)
se le haya caído -> cáiaselle (prs)
se le hubiera caído -> caéseselle (pis)
se lo haya dicho -> dígallo (prs)
se lo hubiera dicho -> dixésello (pis)
-->

    
    <rule>
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <and>
                <equal caseless="yes">
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="se"/>
                </equal>  
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="lem"/>
                  <lit v="le"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="3" side="sl" part="persona"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <lit v="se"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref.p3.mf.sp"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="3" side="sl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="3" side="sl" part="persona"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <lit v="lle"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p3.mf.sg"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          <when>
            <test>
              <and>
                <equal caseless="yes">
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="se"/>
                </equal>  
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="lem"/>
                  <lit v="le"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="temps"/>
                  <lit-tag v="pii"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <lit-tag v="pmp.p3"/>
                  <!--clip pos="3" side="sl" part="persona"/-->
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <lit v="se"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref.p3.mf.sp"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>       
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="3" side="sl" part="temps"/>
                  <lit-tag v="pii"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <lit-tag v="pmp"/>
                  <clip pos="3" side="sl" part="persona"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <lit v="lle"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p3.mf.sg"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="fti"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="cni"/>
                  </equal>
                </or>
                <equal caseless="yes">
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="se"/>
                </equal>  
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="lem"/>
                  <lit v="le"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <lit-tag v="cni.p3"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <lit v="se"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref.p3.mf.sp"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>         
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="fti"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="cni"/>
                  </equal>
                </or>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <lit-tag v="cni"/>
                  <clip pos="3" side="sl" part="persona"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <lit v="lle"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p3.mf.sg"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="pis"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="prs"/>
                  </equal>
                </or>
                <equal caseless="yes">
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="se"/>
                </equal>  
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="lem"/>
                  <lit v="le"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <clip pos="3" side="sl" part="temps"/>
                  <lit-tag v="p3"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <lit v="se"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref.p3.mf.sp"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>        
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="pis"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="prs"/>
                  </equal>
                </or>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <clip pos="3" side="sl" part="temps"/>
                  <clip pos="3" side="sl" part="persona"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <lit v="lle"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p3.mf.sg"/>
                </lu>
                
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
                 
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>
    



<!--
EGV30 pron_procl + pron_procl + haber + participio.
te lo ha dicho -> díxocho (dicir-pret_perfec+te+o)
te lo había dicho -> dixéracho  (dicir-pluscuamperfecto + te + o)
te lo habría/habrá dicho -> diríacho   (dicir-condicional + te + o)
te lo haya dicho -> dígacho (prs)
te lo hubiera dicho -> dixésecho (pis)
-->

    <rule>
      <pattern>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="3" side="sl" part="temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="3" side="sl" part="persona"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="1" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="1" side="tl" part="persona"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="3" side="sl" part="temps"/>
                  <lit-tag v="pii"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <lit-tag v="pmp"/>
                  <clip pos="3" side="sl" part="persona"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="1" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="1" side="tl" part="persona"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          <when>
            <test>
              <and>
                <or><equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="fti"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="cni"/>
                  </equal></or>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <lit-tag v="cni"/>
                  <clip pos="3" side="sl" part="persona"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="1" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="1" side="tl" part="persona"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          <when>
            <test>
              <and>
                <or><equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="pis"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="prs"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="inf"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="sl" part="temps"/>
                    <lit-tag v="xer"/>
                  </equal></or>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <clip pos="3" side="sl" part="temps"/>
                  <clip pos="3" side="sl" part="persona"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="1" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="1" side="tl" part="persona"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>
    
    
<!-- 
EGV31 proclisis + pron_procl_refl + haber + participio.
que se ha/haya/habría/habrá caído -> que se caeu (que + se + caer-pret_perfec)
y se ha/haya/habría/habrá caído -> e caeuse   (caer-pret_perfec + se)
-->
    
    
    <rule>
      <pattern>
        <pattern-item n="proclise"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          
          
          
          <when>
            <test>
              <and>
                <in caseless="yes"><!--in-->
                  <clip pos="1" side="sl" part="lem"/>
                  <list n="pces"/>
                </in>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lem"/> 
                <clip pos="4" side="sl" part="a_verb"/>
                <lit-tag v="ifi"/>
                <clip pos="3" side="sl" part="persona"/>
                <clip pos="3" side="sl" part="nbr"/>
              </lu>
            </out> 
          </when>
          
          
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <get-case-from pos="2">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="3" side="sl" part="persona"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="3">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>      
        </choose>
      </action>
    </rule>
    



<!-- 
EGV32 pron_procl_refl + haber + participio.
se ha/haya/habría/habrá caído -> caeuse (caer-pret_perfec + se)
-->


    <rule>
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="3" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="3" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="3" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="2" side="sl" part="persona"/>
                  <clip pos="2" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="1" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref"/>
                  <clip pos="1" side="tl" part="persona"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>
    
    

<!-- 
EGV33 pron_procl_refl + haber + participio.
que te ha/haya/habría/habrá dicho -> que che dixo  (que + te + caer-pret_perfec)
y te ha/haya/habría/habrá dicho -> e díxoche  (e + caer-pret_perfec + te)
-->
    
    <rule>
      <pattern>
        <pattern-item n="proclise"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          
          
          
          <when>
            <test>
              <and>
                
                <in caseless="yes"><!--in-->
                  <clip pos="1" side="sl" part="lem"/>
                  <list n="pces"/>
                </in>
                
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lem"/> 
                <clip pos="4" side="sl" part="a_verb"/>
                <lit-tag v="ifi"/>
                <clip pos="3" side="sl" part="persona"/>
                <clip pos="3" side="sl" part="nbr"/>
              </lu>
            </out> 
          </when>
          
          
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="4" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <get-case-from pos="2">
                    <clip pos="4" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="4" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="3" side="sl" part="persona"/>
                  <clip pos="3" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="3">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
        </choose>
      </action>
    </rule>
    

<!--
EGV34 pron_procl + haber + participio.
te ha/haya/habría/habrá caído ->  caeuche  (caer-pret_perfec + te)
-->

    <rule>
      <pattern>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="3" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <mlu><lu>
                  <get-case-from pos="1">
                    <clip pos="3" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="3" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="2" side="sl" part="persona"/>
                  <clip pos="2" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <clip pos="1" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="1" side="tl" part="persona"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>
    
    
    
    
    
<!-- 
EGV35 proclisis + pron_procl_refl + pron_procl + haber + participio.
que se lo ha/haya/habría/habrá dicho ->  que llo dixo  (que + se + lo + decir-pret_perfec)
y se lo ha/haya/habría/habrá dicho ->  e díxollo    (decir-pret_perfec + se + lo)
-->
    
    
    <rule>
      <pattern>
        <pattern-item n="proclise"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          
          
          
          <when>
            <test>
              <and>
                
                <in caseless="yes"><!--in-->
                  <clip pos="1" side="sl" part="lem"/>
                  <list n="pces"/>
                </in>
                
                <equal>
                  <clip pos="5" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="5" side="tl" part="lem"/> 
                <clip pos="5" side="sl" part="a_verb"/>
                <lit-tag v="ifi"/>
                <clip pos="4" side="sl" part="persona"/>
                <clip pos="4" side="sl" part="nbr"/>
              </lu>
            </out> 
          </when>
          
          
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="5" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <get-case-from pos="2">
                    <clip pos="5" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="5" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="4" side="sl" part="persona"/>
                  <clip pos="4" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="2">
                    <lit v="lle"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p3.mf.sg"/>
                </lu>
                <lu>
                  <get-case-from pos="4">
                    <clip pos="3" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>
    
    
    
    
<!-- 
EGV36 proclisis + pron_procl + pron_procl + haber + participio.
que te lo ha/haya/habría/habrá dicho ->  que cho dixo  (que + te + lo + decir-pret_perfec)
y te lo ha/haya/habría/habrá dicho ->  e díxocho     (decir-pret_perfec + te + lo)
-->
    
    
    <rule>
      <pattern>
        <pattern-item n="proclise"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="haber"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <choose>
          
          
          
          <when>
            <test>
              <and>
                
                <in caseless="yes"><!--in-->
                  <clip pos="1" side="sl" part="lem"/>
                  <list n="pces"/>
                </in>
                
                <equal>
                  <clip pos="5" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="5" side="tl" part="lem"/> 
                <clip pos="5" side="sl" part="a_verb"/>
                <lit-tag v="ifi"/>
                <clip pos="4" side="sl" part="persona"/>
                <clip pos="4" side="sl" part="nbr"/>
              </lu>
            </out> 
          </when>
          
          
          
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="5" side="sl" part="temps"/>
                  <lit-tag v="pp"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="gen"/>
                  <lit-tag v="m"/>
                </equal>
                <equal>
                  <clip pos="5" side="sl" part="nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </and>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <get-case-from pos="2">
                    <clip pos="5" side="tl" part="lem"/>
                  </get-case-from> 
                  <clip pos="5" side="sl" part="a_verb"/>
                  <lit-tag v="ifi"/>
                  <clip pos="4" side="sl" part="persona"/>
                  <clip pos="4" side="sl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="4">
                    <clip pos="2" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="2" side="tl" part="persona"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                </lu>
                <lu>
                  <get-case-from pos="4">
                    <clip pos="3" side="tl" part="lem"/>
                  </get-case-from>
                  <lit-tag v="prn.enc"/>
                  <clip pos="3" side="tl" part="persona"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                </lu></mlu>
              
            </out> 
          </when>
          
          
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="5" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
          
        </choose>
      </action>
    </rule>
    
    


<!-- 
EGV37 IR/VENIR/VOLVER/ACOSTUMBRAR...+ PREP +INF en distintas combinaciones con clíticos y perífrasis
ir a comer -> ir comer (si al preposición es "a", la quita)
-->
    
    <rule>
      <pattern>
        <pattern-item n="verbir"/>
        <pattern-item n="prep"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal> 
                <clip pos="2" side="sl" part="lem"/>
                <lit v="a"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
            </out>
          </when>
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/> 
              </lu>
            </out> 
          </otherwise>
          
        </choose>
      </action>
    </rule>
    

<!-- 
EGV38 IR/VENIR/VOLVER/ACOSTUMBRAR...+ PREP +INF + PRON_ENCLITICO en distintas combinaciones con clíticos y perífrasis
ir a comerlo -> ir comelo (si al preposición es "a", la quita)
-->    
    <rule>
      <pattern>
        <pattern-item n="verbir"/>
        <pattern-item n="prep"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal> 
                <clip pos="2" side="sl" part="lem"/>
                <lit v="a"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="3" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <clip pos="4" side="tl" part="whole"/> 
                </lu></mlu>
            </out>
          </when>
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="3" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <clip pos="4" side="tl" part="whole"/> 
                </lu></mlu>
            </out> 
          </otherwise>
          
        </choose>
      </action>
    </rule>


<!-- 
EGV39 IR/VENIR/VOLVER/ACOSTUMBRAR...+ PREP +INF + PRON_ENCLITICO  + PRON_ENCLITICO en distintas combinaciones con clíticos y perífrasis
ir a comertelo -> ir comercho  (si al preposición es "a", la quita)
-->      
    
    <rule>
      <pattern>
        <pattern-item n="verbir"/>
        <pattern-item n="prep"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal> 
                <clip pos="2" side="sl" part="lem"/>
                <lit v="a"/>
              </equal>
            </test>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="3" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <clip pos="4" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <clip pos="5" side="tl" part="whole"/> 
                </lu></mlu>
            </out>
          </when>
          
          <otherwise>
            <out>
              <lu>
                <clip pos="1" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <lu>
                <clip pos="2" side="tl" part="whole"/> 
              </lu> 
              <b/>
              <mlu><lu>
                  <clip pos="3" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <clip pos="4" side="tl" part="whole"/> 
                </lu>
                <lu>
                  <clip pos="5" side="tl" part="whole"/> 
                </lu></mlu>
            </out> 
          </otherwise>
          
        </choose>
      </action>
    </rule>
    
    
<!-- 
EGV40 Quitamos ¿
-->   
    <rule>
      <pattern>
        <pattern-item n="lquest"/>
      </pattern>
      <action>
        <!--<let>
          <var n="interrogativa"/>
          <lit v="true"/>
        </let>  -->      
      </action>
    </rule>


<!-- 
EGV41 Cuando detectamos ? ; : ! reseteamos variables, número a singular y género a masculino
-->  

    
    <rule>
      <pattern>
        <pattern-item n="sent"/>
      </pattern>
      <action>
        <let>
          <var n="numero"/>
          <lit-tag v="sg"/>
        </let>
        <let>
          <var n="genero"/>
          <lit-tag v="m"/>
        </let>
        <out>
          <lu>
            <clip pos="1" side="tl" part="whole"/>
          </lu>
        </out>
      </action>
    </rule>
    
    
  </section-rules>
</transfer>
