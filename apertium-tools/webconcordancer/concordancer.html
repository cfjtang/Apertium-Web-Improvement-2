<html>
<head>
	<title>Concordancer</title>
	<link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="./spinner.css" rel="stylesheet">
    <style>
        .left-part { text-align: right; padding-right: 0px !important;}
        .right-part { padding-left: 0px !important; }
    </style>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Concodancer Web Interface</h1>
        <h4>Created by spectie in C and ported to Python by a very intelligent program</h4>
        
        <form class="form-horizontal" style="padding-top: 2em;" action="none" autocomplete="on">
            <div class="form-group">
                <label for="corpus" class="col-sm-2 control-label">Corpus Path</label>
                <div class="col-sm-10">
                    <input class="form-control" type="text" name="corpus" id="corpus" placeholder="Path to corpus to search">
                </div>
            </div>
            
            <div class="form-group">
                <label for="word" class="col-sm-2 control-label">Search String</label>
                <div class="col-sm-5">
                    <input class="form-control" type="text" name="string" id="string" placeholder="String to search corpus with">
                </div>
                
                <label for="word" class="col-sm-2 control-label">Search Window</label>
                <div class="col-sm-3">
                    <input class="form-control" type="number" name="window" id="window" value="50" placeholder="Size of search window (characters)">
                </div>
            </div>
            
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-9">
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" id="instant" checked> Instant Search
                        </label>
                    </div>
                </div>
                <button class="btn btn-default" value="Search" id="search">Search</button>
            </div>
        </form>

        <h2>Results: <span id="resultHelp" class="pull-right"></span></h2>
        <table class="table table-condensed table-hover small" id="output" style='font-family: Monaco,Menlo,Consolas,"Courier New",monospace'>
        </table>
        <div id="loading" style="display: none; position: absolute; top: 50%; left: 50%;">
            <div id="floatingCirclesG">
                <div class="f_circleG" id="frotateG_01"></div>
                <div class="f_circleG" id="frotateG_02"></div>
                <div class="f_circleG" id="frotateG_03"></div>
                <div class="f_circleG" id="frotateG_04"></div>
                <div class="f_circleG" id="frotateG_05"></div>
                <div class="f_circleG" id="frotateG_06"></div>
                <div class="f_circleG" id="frotateG_07"></div>
                <div class="f_circleG" id="frotateG_08"></div>
            </div>
        </div>
    </div>
	
	<script type="text/javascript">
        $(document).ready(function() {
            $('#search').css({visibility: 'hidden'});
            $('#corpus').keydown(function() {if($('#instant').is(':checked')) search(); });
            $('#string').keydown(function() {if($('#instant').is(':checked')) search(); });
            $('#window').keydown(function() {if($('#instant').is(':checked')) search(); });
            $('#search').click(function(ev) {
                ev.preventDefault();
                search();
            });
            
            function search() {
                $("#output").css({ opacity: 0.5 });
                $('#loading').show();
                $.post("/getResults", {corpus: $('#corpus').val(), string: $('#string').val(), window: $('#window').val()}, function(data) {
                    $("#output").css({ opacity: 1 });
                    $('#loading').hide();
					$("#output tr").remove();
					data = JSON.parse(data);
					$('#resultHelp').html(data.length + ' result' + (data.length != 1 ? 's' : ''));
					for(var i = 0; i < data.length; i++) {
						var tr = $('<tr></tr>');
						//tr.append($('<td class="type"></td>').html(data[i][0]));
                        var strong = $('<strong style="color: darkred;"></strong>');
                        var len = $('#string').val().length;
                        var left = data[i][1].trim(), right = data[i][2].trim();
						tr.append($('<td class="left-part"></td>').append(left + ((data[i][1][data[i][1].length - 1] === ' ' || data[i][2][0] === '') ? '&nbsp;' : '')));
						tr.append($('<td class="right-part"></td>').append(strong.html(right.substring(0, len))).append(right.substring(len)));
						$('#output').append(tr);
					}
                }).fail(function(xhr, textStatus, error) {
                    $('#loading').hide();
                    $('#resultHelp').html('<h3 style="color: darkred; font-weight: bold;">FAIL: ' + error + '</h3>');
                });
            }
            
            $('#instant').click(function() {
                if($('#instant').is(':checked'))
                    $('#search').css({opacity: 1.0, visibility: "visible"}).animate({opacity: 0}, 200);
                else
                    $('#search').css({opacity: 0.0, visibility: "visible"}).animate({opacity: 1.0}, 200);
            });
            
            $('form').submit(function() {
                return false;
            });
        });
	</script>
</body>
</html>